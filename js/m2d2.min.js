// https://gitlab.com/lepe/m2d2/ v.1.0.2 . Released under MIT License
"use strict";var m2d2=(function(){var e=function(n,o){if(o!=undefined){n.onRenderDone=o}return new l(n).get()};e.ext=function(n){l.prototype._ext=g(l.prototype._ext,n)};var l=function(o){var n=this;if(!(n instanceof l)){n=new l(o);return n}else{n=g(n,o||{});if(n.auto_init){n.init()}}};l.prototype={root:"body",auto_init:true,html:true,data:{},interval:0,preRender:function(n){},beforeDataRender:function(n,o,p){},afterDataRender:function(n,o,p){},postRender:function(n){},onRenderDone:function(n){},rendered:false,$root:null,init:function(){var n=this;if(c(n._data)){n._func=n._data;n.data=n._doFunc(n._func,n.param,function(p,o){n._onReady();if(o===undefined){if(n.interval*1>0){o=n.interval}}if(o*1>0){n.interval=setInterval(function(){n._func(function(q){n._doRender(n.$root,q)})},o)}})}else{if(!m(this._data)){this._data={text:this._data}}n._onReady()}},update:function(p,o,n){var r=this;if(r.rendered){var q=function(s){if(s._node!=undefined){var t={};t[o]=n.value;r._doRender(s._node,g(s,t))}else{r.clear();r._doRender(r.$root,s)}};if(o===undefined&&c(r._func)){r._doFunc(r._func,p,function(s){q(s)})}else{q(p)}}},render:function(){var n=this;if(n._data==undefined){console.log("data is missing in m2d2 object. Be sure the key 'data' is set.");return false}n.preRender(n);n._doRender(n.$root,n._data);n.postRender(n);n.rendered=true;n.onRenderDone(n.get())},get:function(){var n=this;n._defineProp(n._data,"m2d2",this);n._setProxy();return this._data},clear:function(){var n=this;if(n.rendered){n.$root.innerHTML=n.cache}},_cache:null,_data:null,_func:null,_ext:{},_htmlGenTags:["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","map","mark","menu","meter","nav","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","samp","section","select","small","span","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul","var"],_onReady:function(n){var n=this;n.$root=d(n.root);n.cache=n.$root.innerHTML;n.render()},_doFunc:function(o,p,r){var q=this;var n=o(function(t,s){if(m(t)){if(f(t)&&k(q._data)){q._data=t}else{for(var u in t){q._data[u]=t[u]}}}if(r!=undefined){r(t,s)}},p)||(q._getTemplate(d(q.root),q))?[]:{};if(!k(n)&&!f(n)){console.log("Undefined type of 'data'. For automatic detection do not set any 'return' in the data's function. Or explicitly return '[]' for arrays or '{}' for objects.")}return n},_setProxy:function(n){var o=this;if(o._data._proxy===undefined&&(k(o._data)||f(o._data))){o._data=o._proxy(o._data,function(r,p,q){if(p!="m2d2"&&p[0]!="_"){o.update(r,p,q)}})}},_doRender:function(n,o){var q=this;if(q.events!==undefined){for(var p in q.events){n[p]=q.events[p]}}q._setProxy();if(f(o)){q._doArray(n,q,o)}else{q._setValues(n,o)}},_doArray:function(o,q,v){var s=this;var u=s._getTemplate(o,q);for(var r=0;r<v.length;r++){var p=v[r];if(p._node!=undefined){p._node=undefined}if(!u){if(k(p)){if(Object.keys(p).length==1){if(j(p)){var n=document.querySelector(p);if(n){u=n.outerHTML}else{console.log("Warning: ID selector for template not found: "+p+" . Object:");console.log(q);return}}else{u=i(Object.keys(p)[0]).outerHTML}}else{console.log("Warning: Multiple keys in data without template is not supported yet. Object:");console.log(q);return}}else{console.log("Warning: No template found for object:");console.log(q);return}}var t=h(u);t.setAttribute("data-id",r);o.append(t);s._setValues(t,p)}},_getTemplate:function(n,q){var r=this;if(q._template!=undefined){return q._template}else{var o;if(q.template!=undefined){if(k(q.template)){o=i("div");r._setValues(o,q.template)}else{if(j(q.template)){o=document.querySelector(q.template)}else{if(b(q.template)){o=h("<div>"+q.template+"</div>")}else{o=h("<div>"+i(q.template).outerHTML+"</div>")}}}}else{o=d("template",n)}if(o){var p=o.innerHTML.trim();r._defineProp(q,"_template",p);return p}else{return n.innerHTML.trim()}}},_setValues:function(n,t){var p=this;if(k(t)){p._setNode(n,t);for(var u in t){var v=t[u];if(u=="data"){p._doArray(n,t,v)}else{if(u=="template"){n.innerHTML="<template>"+p._getTemplate(n,t)+"</template>"}else{if(p._ext[u]!=undefined&&c(p._ext[u])){var r=p._ext[u](v,n);if(r){p._setValues(n,r)}}else{if(u[0]=="#"){p._doRender(d(u),v)}else{if(u=="text"||u=="html"){p._setValue(n,u,v)}else{if(u=="dataset"&&k(v)){for(var s in v){n.setAttribute("data-"+s,v[s])}}else{if(u.indexOf("on")==0&&c(v)){n[u]=v}else{if(v instanceof Date){p._setValue(n,u,v)}else{if(p._hasAttr(n,u)&&!(u=="id"&&a(v))){n.setAttribute(u,v)}else{var q=d(u,n);if(!q){q=d("#"+u,n);if(!q){q=d("."+u,n)}if(!q){if(p._htmlGenTags.indexOf(u)!=-1){var o=i(u);n.append(o);p._doRender(o,v)}else{if(!a(u)){n.setAttribute(u,v)}}continue}}p._doRender(q,v)}}}}}}}}}}}else{p._setValue(n,null,t)}},_setValue:function(n,q,r){var t=this;var p=false;if(q==null){if(r==undefined||r==null){console.log("Value was undefined in element :");console.log(n)}else{if(k(r)&&r.text!==undefined){r=r.text}else{if(!a(r)&&b(r)){p=true}}}}else{if(q=="html"){p=true}}if(p){n.innerHTML=r}else{if(q=="value"||(q==null&&t._hasAttr(n,"value")&&(n.tagName!="LI"))){if(t._hasAttr(n,"checked")){if(r==true||r=="true"||r==1){n.setAttribute("checked",true)}else{if(r==false||r=="false"||r==0){n.setAttribute("checked",false)}else{n.value=r}}}else{if(r instanceof Date){n.valueAsDate=r}else{n.value=r}}}else{if(n.childElementCount>0){for(var o in n.childNodes){var s=n.childNodes[o];if(s.nodeType==3){s.replaceWith(r);return}}n.innerHTML=n.innerHTML+r}else{n.innerText=r}}}},_hasAttr:function(o,n){var p=false;if(o&&!a(n)){switch(n){case"checked":p=(o.type!=undefined&&(o.type=="radio"||o.type=="checkbox"));break;default:p=o[n]!=undefined||o.hasAttribute(n)}}return p},_defineProp:function(o,p,n){if(m(o)){if(o[p]===undefined){Object.defineProperty(o,p,{enumerable:false,writable:true});o[p]=n}}},_setNode:function(n,o){this._defineProp(o,"_node",n)},_proxy:function(p,n){this._defineProp(p,"_proxy",true);var o={get:function(t,s,r){if(s=="m2d2"||s[0]=="_"){return t[s]}else{try{if(f(p)&&!a(s)){return t[s]}else{return new Proxy(t[s],o)}}catch(q){return Reflect.get(t,s,r)}}},defineProperty:function(s,q,r){n(s,q,r);return Reflect.defineProperty(s,q,r)},deleteProperty:function(r,q){n(r,q);return Reflect.deleteProperty(r,q)},set:function(s,r,q){s[r]=q;n(s,r,{value:q});return true}};return new Proxy(p,o)},set data(n){var o=this;o._data=n;o.update(o._data)},get data(){var n=this;return n._data}};function g(){for(var o=1;o<arguments.length;o++){for(var n in arguments[o]){if(arguments[o].hasOwnProperty(n)){arguments[0][n]=arguments[o][n]}}}return arguments[0]}var b=function(n){return(n+"").trim().indexOf("<")!==-1};var c=function(n){return typeof n==="function"};var f=function(n){return Array.isArray(n)};var m=function(n){return typeof n==="object"};var k=function(n){return m(n)&&!f(n)};var j=function(n){return(n+"").trim().indexOf("#")==0};var a=function(o){return !isNaN(parseFloat(o))&&isFinite(o)};var d=function(n,o){if(o===undefined){o=document}return o.querySelector(n)};var i=function(n){return document.createElement(n)};var h=function(n){var o=i("template");o.innerHTML=n.trim();return o.content.firstChild};return e})();