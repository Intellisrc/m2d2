// https://gitlab.com/lepe/m2d2/ v.1.1 . Released under MIT License
"use strict";var m2d2=(function(){var f=function(s,q,p){var o={};var r=typeof s;switch(r){case"string":if(q!=undefined){o.root=s;o.data=q;o.template=p}else{o.data=s;return null}break;case"object":case"function":o.data=s;o.template=p;break;default:console.log("First argument passed to m2d2, with value: ("+s+") is of unknown type: "+r);return null}return new m(o).get()};f.ext=function(o){m.prototype._ext=h(m.prototype._ext,o)};var m=function(p){var o=this;if(!(o instanceof m)){o=new m(p);return o}else{o=h(o,p||{});o._init()}};m.prototype={root:"body",data:{},rendered:false,$root:null,update:function(q,p,o){var s=this;if(s.rendered){var r=function(t){if(t._node!=undefined){var u={};u[p]=o.value;s._doRender(t._node,h(t,u))}else{s.clear();s._doRender(s.$root,t)}};if(p===undefined&&c(s._func)){s._doFunc(s._func,q,function(v,u,t){if(u!==undefined){s.template=u}r(v)})}else{r(q)}}},get:function(){var o=this;o._defineProp(o._data,"m2d2",this);o._setProxy();return this._data},clear:function(){var o=this;if(o.rendered){o.$root.innerHTML=o.cache}},_init:function(){var o=this;if(c(o._data)){o._func=o._data;o.data=o._doFunc(o._func,o.param,function(q,p){o._onReady();if(p===undefined){if(o.interval*1>0){p=o.interval}}if(p*1>0){o.interval=setInterval(function(){o._func(function(r){o._doRender(o.$root,r)})},p)}});if(o.data){o._onReady()}}else{if(!n(this._data)){this._data={text:this._data}}o._onReady()}},_render:function(){var o=this;if(o._data==undefined){console.log("data is missing in m2d2 object with root: "+o.root);return false}o._doRender(o.$root,o._data);o.rendered=true},_cache:null,_data:null,_func:null,_ext:{},_htmlGenTags:["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","map","mark","menu","meter","nav","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","samp","section","select","small","span","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul","var"],_onReady:function(o){var o=this;o.$root=d(o.root);o.cache=o.$root.innerHTML;o._render()},_doFunc:function(p,q,s){var r=this;var o=p(function(x,u,t){var v;var w;if(t!==undefined&&a(t)){v=t}else{if(u!==undefined&&a(u)){v=u}}if(u!==undefined&&!a(u)){w=u}if(n(x)){if(g(x)&&l(r._data)){r._data=x}else{for(var y in x){r._data[y]=x[y]}}}if(s!=undefined){s(x,w,v)}},q);if(e(o)){o=(r._getTemplate(d(r.root),r))?[]:{}}if(!l(o)&&!g(o)){console.log("Undefined type of 'data'. For automatic detection do not set any 'return' in the data's function. Or explicitly return '[]' for arrays or '{}' for objects.")}return o},_setProxy:function(o){var p=this;if(p._data._proxy===undefined&&(l(p._data)||g(p._data))){p._data=p._proxy(p._data,function(s,q,r){if(q!="m2d2"&&q[0]!="_"){p.update(s,q,r)}})}},_doRender:function(o,p){var q=this;if(p.oninit!=undefined){p.oninit()}q._setProxy();if(g(p)){q._doArray(o,q,p)}else{q._setValues(o,p)}if(p.onrender!=undefined){p.onrender()}},_doArray:function(p,r,w){var t=this;var v=t._getTemplate(p,r);for(var s=0;s<w.length;s++){var q=w[s];if(q._node!=undefined){q._node=undefined}if(!v){if(l(q)){if(Object.keys(q).length==1){if(k(q)){var o=document.querySelector(q);if(o){v=o.outerHTML}else{console.log("Warning: ID selector for template not found: "+q+" . Object:");console.log(r);return}}else{v=j(Object.keys(q)[0]).outerHTML}}else{console.log("Warning: Multiple keys in data without template is not supported yet. Object:");console.log(r);return}}else{console.log("Warning: No template found for object:");console.log(r);return}}var u=i(v);u.setAttribute("data-id",s);p.append(u);t._setValues(u,q)}},_getTemplate:function(o,r){var s=this;if(r._template!=undefined){return r._template}else{var p;if(r.template!=undefined){if(l(r.template)){p=j("div");s._setValues(p,r.template)}else{if(k(r.template)){p=document.querySelector(r.template)}else{if(b(r.template)){p=i("<div>"+r.template+"</div>")}else{p=i("<div>"+j(r.template).outerHTML+"</div>")}}}}else{p=d("template",o)}if(p){var q=p.innerHTML.trim();s._defineProp(r,"_template",q);return q}else{return o.innerHTML.trim()}}},_setValues:function(o,u){var q=this;if(l(u)){q._setNode(o,u);for(var v in u){var w=u[v];if(v=="data"){q._doArray(o,u,w)}else{if(v=="template"){o.innerHTML="<template>"+q._getTemplate(o,u)+"</template>"}else{if(q._ext[v]!=undefined&&c(q._ext[v])){var s=q._ext[v](w,o);if(s){q._setValues(o,s)}}else{if(v[0]=="#"){q._doRender(d(v),w)}else{if(v=="text"||v=="html"){q._setValue(o,v,w)}else{if(v=="dataset"&&l(w)){for(var t in w){o.setAttribute("data-"+t,w[t])}}else{if(v.indexOf("on")==0&&c(w)){o[v]=w}else{if(w instanceof Date){q._setValue(o,v,w)}else{if(q._hasAttr(o,v)&&!(v=="id"&&a(w))){o.setAttribute(v,w)}else{var r=d(v,o);if(!r){r=d("#"+v,o);if(!r){r=d("."+v,o)}if(!r){if(q._htmlGenTags.indexOf(v)!=-1){var p=j(v);o.append(p);q._doRender(p,w)}else{if(!a(v)){o.setAttribute(v,w)}}continue}}q._doRender(r,w)}}}}}}}}}}}else{q._setValue(o,null,u)}},_setValue:function(o,r,s){var u=this;var q=false;if(r==null){if(s==undefined||s==null){console.log("Value was undefined in element :");console.log(o)}else{if(l(s)&&s.text!==undefined){s=s.text}else{if(!a(s)&&b(s)){q=true}}}}else{if(r=="html"){q=true}}if(q){o.innerHTML=s}else{if(r=="value"||(r==null&&u._hasAttr(o,"value")&&(o.tagName!="LI"))){if(u._hasAttr(o,"checked")){if(s==true||s=="true"||s==1){o.setAttribute("checked",true)}else{if(s==false||s=="false"||s==0){o.setAttribute("checked",false)}else{o.value=s}}}else{if(s instanceof Date){o.valueAsDate=s}else{o.value=s}}}else{if(o.childElementCount>0){for(var p in o.childNodes){var t=o.childNodes[p];if(t.nodeType==3){t.replaceWith(s);return}}o.innerHTML=o.innerHTML+s}else{o.innerText=s}}}},_hasAttr:function(p,o){var q=false;if(p&&!a(o)){switch(o){case"checked":q=(p.type!=undefined&&(p.type=="radio"||p.type=="checkbox"));break;default:q=p[o]!=undefined||p.hasAttribute(o)}}return q},_defineProp:function(p,q,o){if(n(p)){if(p[q]===undefined){Object.defineProperty(p,q,{enumerable:false,writable:true});p[q]=o}}},_setNode:function(o,p){this._defineProp(p,"_node",o)},_proxy:function(q,o){this._defineProp(q,"_proxy",true);var p={get:function(u,t,s){if(t=="m2d2"||t[0]=="_"){return u[t]}else{try{if(g(q)&&!a(t)){return u[t]}else{return new Proxy(u[t],p)}}catch(r){return Reflect.get(u,t,s)}}},defineProperty:function(t,r,s){o(t,r,s);return Reflect.defineProperty(t,r,s)},deleteProperty:function(s,r){o(s,r);return Reflect.deleteProperty(s,r)},set:function(t,s,r){t[s]=r;o(t,s,{value:r});return true}};return new Proxy(q,p)},set data(o){var p=this;p._data=o;p.update(p._data)},get data(){var o=this;return o._data}};function h(){for(var p=1;p<arguments.length;p++){for(var o in arguments[p]){if(arguments[p].hasOwnProperty(o)){arguments[0][o]=arguments[p][o]}}}return arguments[0]}var b=function(o){return(o+"").trim().indexOf("<")!==-1};var c=function(o){return typeof o==="function"};var g=function(o){return Array.isArray(o)};var e=function(o){return o===undefined||(n(o)&&Object.keys(o).length===0)||o==""};var n=function(o){return typeof o==="object"};var l=function(p){return n(p)&&!g(p)};var k=function(o){return(o+"").trim().indexOf("#")==0};var a=function(o){return !isNaN(parseFloat(o))&&isFinite(o)};var d=function(o,p){if(p===undefined){p=document}return p.querySelector(o)};var j=function(o){return document.createElement(o)};var i=function(o){var p=j("template");p.innerHTML=o.trim();return p.content.firstChild};return f})();