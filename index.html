<html>
<head>
<title>Demo using M2D2</title>
<meta name="HandheldFriendly" content="1">
<meta name="viewport" content="width=device-width, maximum-scale=1.0">
<meta name="theme-color" content="#333333">
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link rel="stylesheet" href="css/index.css" type="text/css" />
<script src="js/m2d2.src.js" type="text/javascript"></script>
<script type="text/javascript">
// XHR Get function:
var getXHR = function(url, callback) {
    var request = new XMLHttpRequest();
    request.open('GET', url, true);
    request.onload = function() {
      if (request.status >= 200 && request.status < 400) {
        var data = JSON.parse(request.responseText);
        callback(data);
      }
    };
    request.send();
};
// These are dummy data:
var list = [
    {
          id : 1,
          price: 100,
          name : "Doggy Bag",
          style : "color: #713c3c"
    },{
          id : 2,
          price: 200,
          name : "Skateboard",
          style : "color: #3c7141"
    },{
          id    : 5,
          price : 500,
          name  : "Sassy Pants",
          style : "color: #3c3f71"
    }
];
var struc = {
	template : "<dt></dt><dd></dd><div>Visit: <a></a></div>", 
	/* Template can also be written as :
	template: {
		dt : '',
		dd : '',
		div : {
			text : 'Visit: ',
			a : ''
		}
	}
	*/
	dt : "Simple is best",
	dd : "Isn't great to be able to have such freedom, flexibility and simplicity?",
	a  : {
		href : "http://example.com",
		target: "_blank",
		text : "example.com"
    }
}

document.addEventListener("DOMContentLoaded", function() {
    // Most simple example using a String as data
    var title = m2d2({
        root : "h1",
        data : "M2D2 Demo"
    });

    // Simple example using an object
    var info = m2d2({
        root : ".info",
        data : struc
    });

    // This example is to show how to generate lists
    var model = m2d2({
        root : "#items",
        data : list
    });

    // This example, is to demonstrate how to use the interval
    var clock = m2d2({
        root : "#datetime",
        data : function(callback) {
            //We could retrieve the date from a remote server...
            var date = new Date();
            callback({
                time : { 
                    text : "Now: " + date,
                    datetime : date,
                    title: "Attribute datetime is also changing!"
                }
            }); // call function each 1sec.
            //}, 1000); // call function each 1sec.
        }
    });

    // This is similar to "clock" example, but using a remote server and
    // it will use a parameter when updating
    var user = m2d2({
        root: "#user",
        data : function(callback, param) {
            if(param == undefined) {
                param = 1;
            }
            getXHR("https://jsonplaceholder.typicode.com/users?id="+param,function(json) {
                json = json[0]; //get the first item
                callback({
                    user : json.username,
                    name : json.name,
                    email: json.email,
                    zip  : json.address.zipcode,
                    url  : {
                        a:  {
                            href : "http://" + json.website,
                            text : json.website,
                            target : "_blank"
                        }
                    }
                });
            });
        }
    });

    // This example uses the content inside <select> as template, which is an <option> tag.
    var users = m2d2({
        root: "#users",
        data : function(callback) {
            getXHR("https://jsonplaceholder.typicode.com/users",function(json) {
                var usersList = [];
                for(var u in json) {
                    var usr = json[u];
                    usersList.push({
                        id		: usr.id,
                        text	: usr.username,
                        value	: usr.id
                    });
                }
                callback(usersList);
            });
        }
    });

    var events = m2d2({
        data : {
            "#title" : {
                onkeyup : function(event) {
                    title.text = this.value;
                }
            },
            "#link"  : {
                onkeyup : function(event) {
                    info.a.text = this.value;
                }
            },
            "#price" : {
                onkeyup : function(event) {
                    model[1].price = this.value * 1;
                }
            },
            ".add" : {
                onclick : function(event) {
                    model.push({
                      id    : Math.round((Math.random() * 1000 / 100)),
                      price : Math.round((Math.random() * 100000 / 100)),
                      name  : "Extra Item",
                      style : "color: #B17E28"
                    });
                }
            },
            ".remove" : { 
                onclick : function(event) {
                    model.splice(0, 1);
                }
            },
            "#users" : {
                onchange : function(event) {
                    user.m2d2.update(this.value);
                }
            }
        }
    });
});
</script>
</head>
<body>
<h1>Title</h1>
<div class="info"></div>
<div class="controls">
    <div>New Title: <input id="title" type="text" /></div>
    <div>New Link: <input id="link" type="text" /></div>
</div>
<table id="checkout">
  <caption>My whish list:</caption>
  <tbody id="items">
    <template>
        <tr>
          <td class="id"></td>
          <td><a class="name"></a></td>
          <td>$ <span class="price"></span></td>
        </tr>
    </template>
  </tbody>
</table>
<div class="controls">
    <div><button class="add">Add Row</button><button class="remove">Remove Row</button></div>
    <div>New Price: <input id="price" type="number" /></div>
</div>
<table id="user">
  <caption>User Info:</caption>
  <tr><th>Username</th><td class="user"></td></tr>
  <tr><th>Name</th><td class="name"></td></tr>
  <tr><th>E-Mail</th><td class="email"></td></tr>
  <tr><th>Zip Code</th><td class="zip"></td></tr>
  <tr><th>Website</th><td class="url"></td></tr>
</table>
<div class="controls">
	<div>User: 
		<select id="users">
			<option>Choose one:</option>
		</select>
	</div>
</div>
<div id="datetime">
    <time>Time Now</time>
</div>
</body>
</html>
