<html>
<head>
<title>Demo using M2D2</title>
<meta name="HandheldFriendly" content="1">
<meta name="viewport" content="width=device-width, maximum-scale=1.0">
<meta name="theme-color" content="#333333">
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link rel="stylesheet" href="css/index.css" type="text/css" />
<script src="js/jquery.js"></script>
<script src="js/m2d2.src.js" type="text/javascript"></script>
<script type="text/javascript">
var list = [
    {
          id : 1,
          price: 100,
          name : "Doggy Bag",
          style : "color: #713c3c"
    },{
          id : 2,
          price: 200,
          name : "Skateboard",
          style : "color: #3c7141"
    },{
          id    : 5,
          price : 500,
          name  : "Sassy Pants",
          style : "color: #3c3f71"
    }
];
var struc = {
	template : "<dt></dt><dd></dd><div>Visit: <a></a></div>",
	dt : "Simple is best",
	dd : "Isn't great to be able to have such freedom, flexibility and simplicity?",
	a  : {
		href : "http://example.com",
		target: "_blank",
		text : "example.com"
    }
}
//These variables are set global, so you can play with them:
var title, info, model, clock, user, users
$(function($) {

	// Most simple example using a String as data
	title = m2d2({
		root : "h1",
		data : "M2D2 Demo"
	});

	// Simple example using an object
    info = m2d2({
		root : ".info",
        data : struc
    });

	// This example is to show how to generate lists
	model = m2d2({
        root : "#items",
        data : list
    });

	// This example, is to demonstrate how to use the interval
    clock = m2d2({
        root : "#datetime",
        data : function(callback) {
            //We could retrieve the date from a remote server...
            var date = new Date();
            callback({
                time : { 
                    text : "Now: " + date,
                    datetime : date,
                    title: "Attribute datetime is also changing!"
                }
            }, 1000); //1000: call function each 1sec.
        }
    });

	// This is similar to "clock" example, but using a remote server and
	//  it will use a parameter when updating
	user = m2d2({
		root: "#user",
		data : function(callback, param) {
			if(param == undefined) {
				param = 1;
			}
			$.get("https://jsonplaceholder.typicode.com/users?id="+param,function(json) {
				json = json[0]; //get the first item
				callback({
					user : json.username,
					name : json.name,
					email: json.email,
					zip  : json.address.zipcode,
					url  : {
						a:  {
							href : "http://" + json.website,
							text : json.website,
							target : "_blank"
						}
					}
				});
			});
		}
	});

	// This example will use the inline "template" option.
	users = m2d2({
		root: "#users",
		template : "<option></option>",
		data : function(callback) {
			$.get("https://jsonplaceholder.typicode.com/users",function(json) {
				var users = [];
				for(var u in json) {
					var usr = json[u];
					users.push({
						id		: usr.id,
						text	: usr.username,
						value	: usr.id
					});
				}
				callback(users);
			});
		}
	});

	// Events -------------------------------
	$("#title").keyup(function(){
		title.text = $(this).val();
	});
	$("#link").keyup(function(){
		info.a.text = $(this).val();
	});
	$("#price").keyup(function(){
		model[1].price = $(this).val() * 1;
	});
    $(".add").click(function(){
        model.push({
          id    : Math.round((Math.random() * 1000 / 100)),
          price : Math.round((Math.random() * 100000 / 100)),
          name  : "Extra Item",
          style : "color: #B17E28"
        });
    });
    $(".remove").click(function(){
        model.splice(0, 1);
    });
	$("#users").change(function(){
		user.m2d2.update($(this).val());
	});
});
</script>
</head>
<body>
<h1>Title</h1>
<div class="info"></div>
<div class="controls">
    <div>New Title: <input id="title" type="text" /></div>
    <div>New Link: <input id="link" type="text" /></div>
</div>
<table id="checkout">
  <caption>My whish list:</caption>
  <tbody id="items">
    <template>
        <tr>
          <td class="id" />
          <td>
            <a class="name"></a>
          </td>
          <td>
            $ <span class="price"></span>
          </td>
        </tr>
    </template>
  </tbody>
</table>
<div class="controls">
    <div><button class="add">Add Row</button><button class="remove">Remove Row</button></div>
    <div>New Price: <input id="price" type="number" /></div>
</div>
<table id="user">
  <caption>User Info:</caption>
  <tr><th>Username</th><td class="user"></td></tr>
  <tr><th>Name</th><td class="name"></td></tr>
  <tr><th>E-Mail</th><td class="email"></td></tr>
  <tr><th>Zip Code</th><td class="zip"></td></tr>
  <tr><th>Website</th><td class="url"></td></tr>
</table>
<div class="controls">
	<div>User: <select id="users"></select></div>
</div>
<div id="datetime">
    <time>Time Now</time>
</div>
</body>
</html>
