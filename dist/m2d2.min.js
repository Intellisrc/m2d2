"use strict";class Utils{static sleep(t){return new Promise(e=>setTimeout(e,t))}static htmlNode(t){const e=Utils.newNode("template");return e.innerHTML=t.trim(),e.content.firstChild}static newNode(t){return document.createElement(t)}static node(t,e){return void 0===e&&(e=document),t instanceof Node?t:e.querySelector(t)}static isString(t){return"string"==typeof t}static isBool(t){return"boolean"==typeof t}static isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}static isSelectorID(t){return 0===(t+"").trim().indexOf("#")}static isPlainObject(t){return Utils.isObject(t)&&!Utils.isArray(t)}static isObject(t){return"object"==typeof t}static isArray(t){return Array.isArray(t)}static isFunction(t){return"function"==typeof t}static isNode(t){return t instanceof HTMLElement}static isHtml(t){return-1!==(t+"").trim().indexOf("<")}static isEmpty(t){return void 0===t||Utils.isObject(t)&&0===Object.keys(t).length||""===t}static cleanArray(t){return t.filter((function(t){return 0===t||t}))}}
class m2d2{"use strict";constructor(){}static instance=new m2d2;static ready(e){document.addEventListener("DOMContentLoaded",()=>{let t=(e,t)=>this.instance.getProxyNode(e,t);t.extendDOM=this.instance.extDom,e(t)})}extDom(e,t){if(!e)return console.error("Selector was empty"),null;void 0===t&&(t=document);const s=Utils.isNode(e)?e:t.querySelector(e);return s?void 0===s._m2d2?(s._m2d2=!0,["find","findAll","onupdate","show","css","text","html"].forEach(e=>{s.hasOwnProperty(e)&&(console.log("Node already had ["+e+"] property. It might cause unexpected behaviour."),console.log("You may need to update the M2D2 version or report it to: github.com/lepe/m2d2/"))}),Object.defineProperty(s,"text",{get(){return this.childNodes.length?this.innerText:this.textContent},set(e){if(this.childNodes.length){let t=!1;this.childNodes.forEach(s=>{"Text"===s.constructor.name&&(s.nodeValue=e,t=!0)}),t||this.prepend(document.createTextNode(e))}else this.textContent=e}}),Object.defineProperty(s,"html",{get(){return this.innerHTML},set(e){this.innerHTML=e}}),Object.defineProperty(s,"css",{get(){return this.classList},set(e){Utils.isArray(e)?this.className=e.join(" "):Utils.isString(e)?this.className=e:Utils.isPlainObject(e)?Object.keys(e).forEach(t=>{e[t]?this.classList.add(t):this.classList.remove(t)}):console.error("Trying to assign a wrong value to css : "+e)}}),Object.defineProperty(s,"show",{get(){const e=this.getBoundingClientRect(),t="none"!==this.style.display,s="hidden"!==this.style.visibility;return t&&s&&e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},set(e){const t=()=>getComputedStyle(this,null).display,s=()=>{const e=document.getElementsByTagName("body")[0],t=document.createElement("template"),s=document.createElement(this.tagName);t.appendChild(s),e.appendChild(t);const i=getComputedStyle(s,null).display;return t.remove(),i};if(e){if("none"===t())if(this._m2d2_display)this.style.display=this._m2d2_display;else if(this.style.removeProperty("display"),"none"===t()){const e=s();this.style.display=this.dataset.display||("none"!==e?e:"block")}}else{const e="none"!==this.style.display?this.style.display:t();"none"!==e&&(this._m2d2_display=e),this.style.display="none"}}}),Object.assign(s,{find:e=>{const t=s.querySelector(e);return t?this.extDom(t):null},findAll:e=>{const t=s.querySelectorAll(e);return t.forEach(e=>{this.extDom(e)}),t}}),s):s:(Utils.isString(e)?(console.error("Selector: "+e+" didn't match any element in node:"),console.log(t)):console.error("Node was null"),null)}doDom(e,t){if(Utils.isObject(e)&&void 0===t&&(t=e,e="body"),!Utils.isString(e)&&!Utils.isNode(e)||!t)return console.error("Passed parameters to m2d2 are wrong."),console.log("First parameter must be string:"),console.log(e),console.log("Second parameter must be not be empty:"),console.log(t),null;const s=this.extDom(e);if(t=this.plainToObject(s,t),Object.keys(t).forEach(e=>{let i=t[e],o=this.hasProp(s,e),n=!1;if(this.hasAttr(s,e)||o)switch(!0){case"value"===e&&this.hasProp(s,"valueAsDate")&&i instanceof Date:e="valueAsDate";case"css"===e:case typeof i==typeof s[e]:case Utils.isString(s[e])&&Utils.isNumeric(i):case Utils.isFunction(i)&&Utils.isObject(s[e]):case Utils.isBool(i)&&Utils.isString(s[e]):case"object"==typeof s[e]&&"INPUT"===s.tagName:n=!0}if(n){let t=!1;switch(e){case"classList":Utils.isArray(i)?i.forEach(t=>{s[e].add(t)}):Utils.isString(i)?s[e].add(i):t=!0;break;case"style":case"dataset":Utils.isPlainObject(i)?Object.assign(s[e],i):t=!0;break;default:switch(!0){case Utils.isBool(i):case this.hasAttrOrProp(s,e):this.setPropOrAttr(s,e,i);break;default:s[e]=i}}t&&(console.error("Invalid value passed to '"+e+"': "),console.log(i),console.log("Into Node:"),console.log(s))}else{const o=[];try{if("template"!==e){if(e&&e.match(/^\w/)){let t=s.find("#"+e);t&&-1===o.indexOf(t)&&o.push(t),t=s.find("[name="+e+"]"),t&&-1===o.indexOf(t)&&o.push(t);const i=Array.from(s.findAll("."+e)).filter(e=>-1===o.indexOf(e));i.length>0&&o.push(i)}const t=Array.from(s.findAll(e)).filter(e=>-1===o.indexOf(e));t.length>0&&o.push(t)}}catch(t){return console.error("Invalid selector: "+e),void console.log(t)}if(o.length>1)console.error("Multiple options found for key: "+e+" under element: "),console.log(s),console.log("Options: "),o.forEach(e=>{console.log(e)}),console.log("Please rename key or adjust DOM");else if(1===o.length){const n=o[0];if(Utils.isArray(n))if(1===n.length)this.renderAndLink(s,n[0],e,i);else{const t=[];n.forEach(s=>{t.push(this.render(s,e,i))}),this.linkNode(s,e,t)}else if(Utils.isNode(n))if(Utils.isArray(i)){const o=t.template;this.doItems(n,i,o),this.linkNode(s,e,n)}else this.renderAndLink(s,n,e,i);else console.error("BUG: It should have been a node but got: "),console.log(n),console.log("Parent node:"),console.log(s)}else if(0===o.length)if("template"===e&&void 0===t.items&&(e="items",i=[]),this.isValidElement(e)){const t=this.appendElement(s,e);this.renderAndLink(s,t,e,i)}else if(void 0!==i.tagName){const t=i.tagName,o=this.appendElement(s,t);delete i.tagName,this.renderAndLink(s,o,e,i)}else if("items"===e){const e=t.template;if(Utils.isPlainObject(i)){const e=[];Object.keys(i).forEach(t=>{const o={text:i[t]};this.hasAttrOrProp(s,"value")?o.value=t:o.dataset={id:t},e.push(o)}),i=e}Utils.isArray(i)?this.doItems(s,i,e):(console.log("Warning: 'items' specified but value is not and array, in element: "),console.log(s),console.log("Passed values are: "),console.log(i))}else Utils.isFunction(i)?("onupdate"===e&&s.addEventListener(e,i),s[e]=i):"template"!==e&&(console.error("Not sure what you want to do with key: "+e+" under element: "),console.log(s),console.log("And object:"),console.log(t),s[e]=i)}}),s.onload){const e=["BODY","FRAME","IFRAME","IMG","LINK","SCRIPT","STYLE"].indexOf(s.tagName)>=0,t="INPUT"===s.tagName&&"image"===s.type;if(!e&&!t){const e=new CustomEvent("onload");s.addEventListener("onload",s.onload),s.dispatchEvent(e)}}return s}plainToObject(e,t){return Utils.isPlainObject(t)||Utils.isFunction(t)||(Utils.isHtml(t)?t={html:t}:this.hasProp(e,"value")?t={value:t}:Utils.isString(t)||Utils.isNumeric(t)?t={text:t}:Utils.isArray(t)&&(t={items:t})),t}renderAndLink(e,t,s,i){const o=this.render(t,s,i);this.linkNode(e,s,o)}render(e,t,s){return s=this.plainToObject(e,s),this.doDom(e,s)}linkNode(e,t,s){if(e[t]===s)try{e[t]=this.proxy(s)}catch(e){}else this.hasAttrOrProp(e,t)?(e["$"+t]=s,console.log("Property : "+t+" existed in node: "+e.tagName+". Using $"+t+" instead for node: "+s.tagName+".")):e[t]=this.proxy(s)}isValidElement(e){const t=Utils.newNode(e);return"template"!==e&&"HTMLUnknownElement"!==t.constructor.name}appendElement(e,t){const s=Utils.newNode(t);return e.append(s),s}getItem(e,t,s,i){i||(i=this.getTemplate(e));const o=i.cloneNode(!0);return o.dataset.id=t,this.setUniqueAttrib(o,"selected"),this.doDom(o,s)}doItems(e,t,s){const i=this.getTemplate(e,s),o=new DocumentFragment;let n=0;for(t.forEach(t=>{t=this.plainToObject(e,t);const s=this.getItem(e,n++,t,i);o.appendChild(s)});o.firstChild;)e.appendChild(o.firstChild);const r=e.find("template");r&&e.removeChild(r),e.items=e.children,this.extendItems(e)}getTemplate(e,t){if(void 0!==e._template&&""!==e._template)return e._template;{let s;if(t){if(Utils.isPlainObject(t)){const e=Utils.newNode("div");s=this.doDom(e,t)}else s=Utils.isHtml(t)?Utils.htmlNode("<div>"+t+"</div>"):Utils.isSelectorID(t)?document.querySelector(t):Utils.htmlNode("<div>"+Utils.newNode(t).outerHTML+"</div>");s&&s.childElementCount>0&&(s=s.firstChild)}else if(e.find("template"))s=Utils.htmlNode(Utils.node("template",e).innerHTML);else switch(e.tagName){case"SELECT":case"DATALIST":s=Utils.newNode("option");break;case"UL":case"OL":s=Utils.newNode("li");break;case"NAV":s=Utils.newNode("a");break;case"DL":s=Utils.htmlNode("<dt></dt><dd></dd>");break;default:e.childElementCount>0&&(s=e.firstChild.cloneNode(!0))}return s&&this.defineProp(e,"_template",s),s}}getAttrOrProp(e,t){let s="";return this.hasAttrOrProp(e,t)&&(s=this.hasAttr(e,t)?e.getAttribute(t):e[t]),s}hasAttrOrProp(e,t){return this.hasAttr(e,t)||this.hasProp(e,t)}hasAttr(e,t){let s=!1;if(e&&!Utils.isNumeric(t))switch(t){case"checked":s=void 0!==e.type&&("radio"===e.type||"checkbox"===e.type);break;default:s=e.hasAttribute(t)}return s}hasProp(e,t){let s=!1;return e&&!Utils.isNumeric(t)&&(s=!(void 0===e[t]||e[t]instanceof Node||e.hasAttribute(t))),s}setPropOrAttr(e,t,s){if(this.hasProp(e,t))try{e[t]=s}catch(i){this.setAttr(e,t,s)}else this.setAttr(e,t,s)}setAttr(e,t,s){s?e.setAttribute(t,s):e.removeAttribute(t)}setUniqueAttrib(e,t){const s=this;e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:function(){return this.hasAttribute(t)},set:function(e){const i=this.parentNode?this.parentNode.find("["+t+"]"):null;i&&i.removeAttribute(t),s.setAttr(this,t,e)}})}defineProp(e,t,s){Utils.isObject(e)&&void 0===e[t]&&(Object.defineProperty(e,t,{enumerable:!1,writable:!0}),e[t]=s)}proxy(e){if(void 0!==e._proxy)return e;return e._proxy=!0,new Proxy(e,{get:(e,t,s)=>{const i=e[t];return"function"==typeof i?i.bind(e):i},set:(e,t,s)=>{let i="";if(Utils.isNode(e[t])){let o="";Utils.isHtml(s)?o="html":this.hasAttrOrProp(e[t],"value")?o="value":(Utils.isString(s)||Utils.isNumeric(s))&&(o="text"),o&&(i=e[t][o],e[t][o]=s)}else"onupdate"===t?Utils.isFunction(s)?(e.addEventListener("onupdate",s),i=e[t],e[t]=s):(console.error("Value passed to 'onupdate' is incorrect, in node:"),console.log(e),console.log("Value: (not a function)"),console.log(s)):"items"===t?(e.items.clear(),this.doItems(e,s)):(i=e[t],e[t]=s);return void 0!==e.onupdate&&s!==i&&e.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:t,newValue:s,oldValue:i}})),!0}})}onObserve(e,t){e.forEach(e=>{const t=e.target;if(void 0!==t.onupdate)if("attributes"===e.type){const s=this.getAttrOrProp(t,e.attributeName);s!==e.oldValue&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:e.attributeName,newValue:s,oldValue:e.oldValue}}))}else if("childList"===e.type){if("#text"===(e.addedNodes[0]||e.removedNodes[0]).nodeName){const s=e.addedNodes[0].textContent,i=e.removedNodes[0].textContent;s!==i&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:"text",newValue:s,oldValue:i}}))}else if(void 0!==t.items){const s=e.addedNodes,i=e.removedNodes;s!==i&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:"items",newValue:s,oldValue:i}}))}}})}observe(e){const t={attributeOldValue:!0,subtree:!0,childList:!0};new MutationObserver(this.onObserve.bind(this)).observe(e,t)}getProxyNode(e,t){const s=this.doDom(e,t);return this.observe(s),this.proxy(s)}extendItems(e){function t(t){t.forEach(t=>{const s=t.parentNode.removeChild(t);e.appendChild(s)})}const s=e.items;Object.getOwnPropertyNames(Array.prototype).concat(["clear","getId","removeId"]).forEach(i=>{if(void 0===s[i]){let o=null;const n=this;switch(i){case"copyWithin":case"fill":case"splice":case"reverse":o=function(...e){if(this.items.length){const s=Array.from(this.items),o=s[i](...e);return t(s),o}};break;case"clear":o=function(){for(;this.items[0];)this.items[0].remove()};break;case"getId":o=function(e){let t=null;return this.items.length&&this.items.some(s=>{if(s.dataset&&1*s.dataset.id===e)return t=s,!0}),t};break;case"pop":o=function(){if(this.items.length){return this[0].parentNode.removeChild(this.items[this.items.length-1])}};break;case"push":o=function(e){if(e instanceof HTMLElement)this.appendChild(e);else if(Utils.isPlainObject(e)){const t=this.items.length,s=n.getItem(this,t,e);this.appendChild(s)}};break;case"removeId":o=function(e){this.items.length&&this.items.some(t=>{if(t.dataset&&1*t.dataset.id===e)return t.remove(),!0})};break;case"shift":o=function(){if(this.items.length){return this.items[0].parentNode.removeChild(this.items[0])}};break;case"sort":o=function(e){if(this.items.length){const s=Array.from(this.items);s.sort(e||((e,t)=>e.text.localeCompare(t.text))),t(s)}};break;case"unshift":o=function(e){if(e instanceof HTMLElement)this.prepend(e);else if(Utils.isPlainObject(e)){const t=this.items.length,s=n.getItem(this,t,e);this.prepend(s)}};break;default:"function"==typeof Array.prototype[i]&&(o=Array.prototype[i])}o&&this.defineProp(s,i,o.bind(e))}})}}