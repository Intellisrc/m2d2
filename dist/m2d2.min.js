"use strict";class Utils{isString(t){return"string"==typeof t}isBool(t){return"boolean"==typeof t}isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}isSelectorID(t){return 0===(t+"").trim().indexOf("#")}isPlainObject(t){return"Object"===t.constructor.name}isObject(t){return"object"==typeof t}isArray(t){return Array.isArray(t)}isFunction(t){return"function"==typeof t}isElement(t){return t instanceof HTMLElement}isNode(t){return t instanceof Node||t instanceof DocumentFragment}isHtml(t){return-1!==(t+"").trim().indexOf("<")}isEmpty(t){return void 0===t||this.isObject(t)&&0===Object.keys(t).length||""===t}cleanArray(t){return t.filter((function(t){return 0===t||t}))}isValidElement(t){const e=this.newElement(t);return"template"!==t&&"HTMLUnknownElement"!==e.constructor.name}getAttrOrProp(t,e){let r="";return this.hasAttrOrProp(t,e)&&(r=this.hasAttr(t,e)?t.getAttribute(e):t[e]),r}hasAttrOrProp(t,e){return this.hasAttr(t,e)||this.hasProp(t,e)}hasAttr(t,e){let r=!1;if(t&&!this.isNumeric(e))switch(e){case"checked":r=void 0!==t.type&&("radio"===t.type||"checkbox"===t.type);break;default:r=void 0!==t.hasAttribute&&t.hasAttribute(e)}return r}hasProp(t,e){let r=!1;if(t&&!this.isNumeric(e)){let i=void 0!==t[e];i&&null===t[e]&&"value"===e&&(i=!1),r=i&&!(t[e]instanceof Node)&&!t.hasAttribute(e)}return r}setPropOrAttr(t,e,r){if(this.hasProp(t,e))try{t[e]=r}catch(i){this.setAttr(t,e,r)}else this.setAttr(t,e,r)}setAttr(t,e,r){r?t.setAttribute(e,r):t.removeAttribute(e)}defineProp(t,e,r){this.isObject(t)&&void 0===t[e]&&(Object.defineProperty(t,e,{enumerable:!1,writable:!0}),t[e]=r)}htmlElement(t){const e=this.newElement("template");return e.innerHTML=t.trim(),e.content.firstChild}newElement(t){return document.createElement(t)}newEmptyNode(){return new DocumentFragment}getMethods(t){const e=Reflect.getPrototypeOf(t),r=Reflect.getPrototypeOf(e);return Reflect.ownKeys(e).filter(t=>Reflect.ownKeys(r).indexOf(t)<0)}appendAllChild(t,e){for(;t.firstChild;)e.append(t.firstChild)}prependAllChild(t,e){for(;t.firstChild;)e.prepend(t.firstChild)}}
class m2d2{"use strict";_storedEvents=[];static storedEventsTimeout=50;static short=!0;static updates=!0;static utils=new Utils;constructor(){}static instance=new m2d2;static extensions={};static main=(()=>{const e=(e,t)=>this.instance.getProxyNode(e,t);return m2d2.utils.getMethods(m2d2.utils).forEach(t=>{e[t]=m2d2.utils[t]}),e})();static ready(e){document.addEventListener("DOMContentLoaded",()=>{e(m2d2.main)})}static load(e){if(void 0!==e){const t=e(m2d2.main);m2d2.utils.isObject(t)&&!m2d2.utils.isEmpty(t)&&Object.keys(t).forEach(e=>{if(m2d2.utils.isValidElement(e)){void 0===m2d2.extensions[e]&&(m2d2.extensions[e]={});const s=m2d2.utils.newElement(e);Object.keys(t[e]).forEach(t=>{m2d2.utils.hasProp(s,t)&&console.log("Warning: property ["+t+"] already exists in node: ["+e+"] while trying to extend it. Unexpected behaviour may happen.")}),Object.assign(m2d2.extensions[e],t[e])}else{void 0===m2d2.extensions["*"]&&(m2d2.extensions["*"]={});const s=m2d2.utils.newElement("div");Object.keys(t[e]).forEach(e=>{m2d2.utils.hasProp(s,e)&&console.log("Warning: property ["+e+"] already exists in Node while trying to extend it. Unexpected behaviour may happen.")}),Object.assign(m2d2.extensions["*"],t[e])}})}return m2d2.main}extDom(e,t){if(!e)return console.error("Selector was empty"),null;void 0===t&&(t=document);const s=m2d2.utils.isNode(e)?e:t.querySelector(e);if(!s)return m2d2.utils.isString(e)?(console.error("Selector: "+e+" didn't match any element in node:"),console.log(t)):console.error("Node was null"),null;if(void 0===s._m2d2){s._m2d2=!0,["parent","sibling","find","findAll","onupdate","show","onshow","css","text","html","getData"].forEach(e=>{s.hasOwnProperty(e)&&(console.log("Node already had ["+e+"] property. It might cause unexpected behaviour."),console.log("You may need to update the M2D2 version or report it to: github.com/lepe/m2d2/"))}),Object.defineProperty(s,"text",{get(){return this.childNodes.length?this.innerText:this.textContent},set(e){if(this.childNodes.length){let t=!1;this.childNodes.forEach(s=>{"Text"===s.constructor.name&&(s.nodeValue=e,t=!0)}),t||this.prepend(document.createTextNode(e))}else this.textContent=e}}),Object.defineProperty(s,"html",{get(){return this.innerHTML},set(e){this.innerHTML=e}}),Object.defineProperty(s,"css",{get(){return this.classList},set(e){m2d2.utils.isArray(e)?this.className=e.join(" "):m2d2.utils.isString(e)?this.className=e:m2d2.utils.isPlainObject(e)?Object.keys(e).forEach(t=>{e[t]?this.classList.add(t):this.classList.remove(t)}):console.error("Trying to assign a wrong value to css : "+e)}}),Object.defineProperty(s,"show",{get(){const e=this.getBoundingClientRect(),t="none"!==this.style.display,s="hidden"!==this.style.visibility;return t&&s&&e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},set(e){const t=()=>getComputedStyle(this,null).display,s=()=>{const e=document.getElementsByTagName("body")[0],t=document.createElement("template"),s=document.createElement(this.tagName);t.append(s),e.append(t);const n=getComputedStyle(s,null).display;return t.remove(),n};if(e){if("none"===t()){if(this._m2d2_display)this.style.display=this._m2d2_display;else if(this.style.removeProperty("display"),"none"===t()){const e=s();this.style.display=this.dataset.display||("none"!==e?e:"block")}void 0!==this.onshow&&m2d2.utils.isFunction(this.onshow)&&this.onshow(this)}}else{const e="none"!==this.style.display?this.style.display:t();"none"!==e&&(this._m2d2_display=e),this.style.display="none"}}});let e={};return void 0!==m2d2.extensions["*"]&&Object.assign(e,m2d2.extensions["*"]),void 0!==m2d2.extensions[s.tagName]&&Object.assign(e,m2d2.extensions[s.tagName]),Object.assign(s,{parent:()=>this.extDom(s.parentElement),sibling:e=>s.parentElement.find(e),find:e=>{const t=s.querySelector(e);return t?this.extDom(t):null},findAll:e=>{const t=void 0===e?Array.from(s.children):s.querySelectorAll(e);return t.forEach(e=>{this.extDom(e)}),t}},e),["INPUT","TEXTAREA","SELECT"].indexOf(s.tagName)>=0&&m2d2.utils.hasAttrOrProp(s,"value")&&(s.oninput=function(){this.setAttribute("value",this.value)}),"FORM"===s.tagName&&(s.getData=function(){const e={},t=new FormData(this);for(let s of t.entries())""!==s[1]&&(e[s[0]]=s[1]);return e}),s}return s}doDom(e,t){if(m2d2.utils.isObject(e)&&void 0===t&&(t=e,e="body"),!(m2d2.utils.isString(e)||m2d2.utils.isElement(e)||m2d2.utils.isNode(e)))return console.error("Selector is not a string or a Node:"),console.log(e),null;const s=this.extDom(e);if(void 0===t)return s;if(t=this.plainToObject(s,t),Object.keys(t).forEach(e=>{let n=t[e];null==n&&(console.log("Value was not set for key: "+e+", 'empty' was used in object: "),console.log(t),console.log("In node:"),console.log(s),n="");let i=m2d2.utils.hasProp(s,e),o=!1;if(m2d2.utils.hasAttr(s,e)||i)switch(!0){case"value"===e&&m2d2.utils.hasProp(s,"valueAsDate")&&n instanceof Date:e="valueAsDate";case"css"===e:case typeof n==typeof s[e]:case m2d2.utils.isString(s[e])&&m2d2.utils.isNumeric(n):case m2d2.utils.isFunction(n)&&m2d2.utils.isObject(s[e]):case m2d2.utils.isBool(n)&&m2d2.utils.isString(s[e]):case"object"==typeof s[e]&&"INPUT"===s.tagName:o=!0}if(o){let t=!1;switch(e){case"classList":m2d2.utils.isArray(n)?n.forEach(t=>{s[e].add(t)}):m2d2.utils.isString(n)?s[e].add(n):t=!0;break;case"style":case"dataset":m2d2.utils.isPlainObject(n)?Object.assign(s[e],n):t=!0;break;default:switch(!0){case m2d2.utils.isBool(n):case m2d2.utils.hasAttrOrProp(s,e):m2d2.utils.setPropOrAttr(s,e,n);break;default:s[e]=n}}t&&(console.error("Invalid value passed to '"+e+"': "),console.log(n),console.log("Into Node:"),console.log(s))}else{const i=[];try{if("template"!==e&&!m2d2.utils.isFunction(n)){if(e&&e.match(/^\w/)){let t=s.find("#"+e);t&&-1===i.indexOf(t)&&i.push(t),t=s.find("[name="+e+"]"),t&&-1===i.indexOf(t)&&i.push(t);const n=Array.from(s.findAll("."+e)).filter(e=>i.indexOf(e)<0);n.length>0&&n.forEach(e=>i.push(e))}const t=Array.from(s.findAll(e)).filter(e=>i.indexOf(e)<0);t.length>0&&t.forEach(e=>i.push(e))}}catch(t){return console.error("Invalid selector: "+e),void console.log(t)}if(i.length>1){const o=[];i.forEach(t=>{o.push(this.render(t,e,n))}),this.linkNode(s,e,o),void 0!==t.warn&&!1===t.warn||(console.log("Multiple elements were assigned with key: ["+e+"] under node: "),console.log(s),console.log("It might be what we expect, but if it is not expected it could result on some elements mistakenly rendered. You can specify 'warn : false' under that node to hide this message."))}else if(1===i.length){const o=i[0];if(m2d2.utils.isElement(o))if(m2d2.utils.isArray(n)){const i=t.template;this.doItems(o,n,i),this.linkNode(s,e,o)}else this.renderAndLink(s,o,e,n);else console.error("BUG: It should have been a node but got: "),console.log(o),console.log("Parent node:"),console.log(s)}else if(0===i.length){"template"===e&&void 0===t.items&&(e="items",n=[]);const i=m2d2.utils.isFunction(n);if(void 0!==n.tagName){const t=n.tagName,i=this.appendElement(s,t);delete n.tagName,this.renderAndLink(s,i,e,n)}else if(m2d2.utils.isValidElement(e)&&!i){const t=this.appendElement(s,e);this.renderAndLink(s,t,e,n)}else if("items"===e){const e=t.template;if(m2d2.utils.isPlainObject(n)){const e=[];Object.keys(n).forEach(t=>{let i;"DL"===s.tagName?i={dt:t,dd:n[t]}:(i={text:n[t]},m2d2.utils.hasAttrOrProp(s,"value")?i.value=t:i.dataset={id:t}),e.push(i)}),n=e}m2d2.utils.isArray(n)?this.doItems(s,n,e):(console.log("Warning: 'items' specified but value is not and array, in element: "),console.log(s),console.log("Passed values are: "),console.log(n))}else i?m2d2.updates&&("onupdate"===e&&s.addEventListener(e,n,!0),s[e]=n):"template"!==e&&"warn"!==e&&!1!==n&&(void 0!==t.warn&&!1===t.warn||(console.error("Not sure what you want to do with key: "+e+" under element: "),console.log(s),console.log("And object:"),console.log(t),console.log("Most likely the element's property or child no longer exists or the value passed to it is incorrect."),console.log("You can set 'warn : false' property to the element to dismiss this message.")),s[e]=n)}}}),s.onload){const e=["BODY","FRAME","IFRAME","IMG","LINK","SCRIPT","STYLE"].indexOf(s.tagName)>=0,t="INPUT"===s.tagName&&"image"===s.type;if(!e&&!t){const e=new CustomEvent("onload");s.addEventListener("onload",s.onload,!0),s.dispatchEvent(e)}}return s}plainToObject(e,t){return m2d2.utils.isPlainObject(t)||m2d2.utils.isFunction(t)||(m2d2.utils.isHtml(t)?t={html:t}:m2d2.utils.isArray(t)?t={items:t}:m2d2.utils.hasProp(e,"value")?t="SELECT"===e.tagName?{value:t,text:t}:{value:t}:(m2d2.utils.isString(t)||m2d2.utils.isNumeric(t))&&(t={text:t})),t}renderAndLink(e,t,s,n){const i=this.render(t,s,n);this.linkNode(e,s,i)}render(e,t,s){return s=this.plainToObject(e,s),this.doDom(e,s)}linkNode(e,t,s){if(e[t]===s){const n=this.proxy(s);try{e[t]=n}catch(e){}e["$"+t]=n}else m2d2.utils.hasAttrOrProp(e,t)?(e["$"+t]=s,console.log("Property : "+t+" existed in node: "+e.tagName+". Using $"+t+" instead for node: "+s.tagName+".")):e[t]=this.proxy(s)}appendElement(e,t){const s=m2d2.utils.newElement(t);return e.append(s),s}getItem(e,t,s,n){n||(n=this.getTemplate(e));const i=n.cloneNode(!0);this.addTemplatesToItem(n,i),i.dataset.id=t,this.setUniqueAttrib(i,"selected");let o=this.doDom(i,s);return this.getItemWithEvents(e,o)}addTemplatesToItem(e,t){["_template","__template"].forEach(s=>{void 0!==e[s]&&(t[s]=e[s])})}getItemWithEvents(e,t){if(void 0!==e.__template){const s=(e,t)=>(t=t||{},Object.keys(e).forEach(n=>{m2d2.utils.isPlainObject(e[n])?t[n]=s(e[n]):m2d2.utils.isFunction(e[n])&&(t[n]=e[n])}),t);let n=s(e.__template);m2d2.utils.isEmpty(n)||(n=n[Object.keys(n)[0]],t=this.doDom(t,n))}return t}doItems(e,t,s){const n=this.getTemplate(e,s);if(void 0===n)return console.error("Template not found. Probably an array is being used where it is not expected. Node:"),console.log(e),console.log("Value (mistaken?):"),void console.log(t);let i=0;t.forEach(t=>{t=this.plainToObject(e,t);const s=this.getItem(e,i++,t,n);s&&e.append(s)});const o=e.find("template");o&&e.removeChild(o),e.items=e.children,this.extendItems(e)}getTemplate(e,t){if(void 0!==e._template&&""!==e._template)return e._template;{let s;const n=e.querySelector("template");if(n)s=m2d2.utils.htmlElement(n.innerHTML.trim());else switch(e.tagName){case"SELECT":case"DATALIST":s=m2d2.utils.newElement("option");break;case"UL":case"OL":s=m2d2.utils.newElement("li");break;case"NAV":s=m2d2.utils.newElement("a");break;case"DL":s=m2d2.utils.newElement("dd");break;default:if(t){const n=Object.keys(t).length;if(n){if(n>1)if(void 0!==t.tagName){let e={};e[t.tagName]=t,t=e}else console.log("Template has more than one top elements. Using the first one. In: "),console.log(t),console.log("Node: "),console.log(e);const i=Object.keys(t)[0],o=t[i];m2d2.utils.isValidElement(i)?s=m2d2.utils.newElement(i):void 0!==o.tagName?s=m2d2.utils.newElement(o.tagName):(console.error("Template defined an element which can not be identified: ["+i+"], using <span> in:"),console.log(t),console.log("Node: "),console.log(e),s=m2d2.utils.newElement("span"))}else console.error("Template has no definition and it can not be guessed. Using <span>. Template: "),console.log(t),console.log("Node: "),console.log(e),s=m2d2.utils.newElement("span")}else e.childElementCount>0&&(s=m2d2.utils.htmlElement(e.innerHTML.trim()))}if(t)if(m2d2.utils.isPlainObject(t)){const n=m2d2.utils.newEmptyNode();n.append(s);s=this.doDom(n,t).children[0],m2d2.utils.defineProp(e,"__template",t)}else s=m2d2.utils.isHtml(t)?m2d2.utils.htmlElement(t):m2d2.utils.isSelectorID(t)?m2d2.utils.htmlElement(document.querySelector(t).innerHTML):m2d2.utils.newElement(t);if(s.childrenElementCount>1){console.log("Templates only supports a single child. Multiple children were detected, wrapping them with <span>. Template:"),console.log(s);const e=m2d2.utils.newElement("span");e.append(s),s=e}return s&&m2d2.utils.defineProp(e,"_template",s),s}}setUniqueAttrib(e,t){e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:function(){return this.hasAttribute(t)},set:function(e){const s=this.parentNode?this.parentNode.find("["+t+"]"):null;s&&s.removeAttribute(t),m2d2.utils.setAttr(this,t,e)}})}getNode(e,t){return void 0===t&&(t=document),e instanceof Node?e:t.querySelector(e)}proxy(e,t){if(!m2d2.short||null===e||void 0!==e._proxy&&void 0===t)return e;e._proxy=e;return new Proxy(e,{get:(e,t,s)=>{const n=e[t];switch(!0){case null==n:return null;case"function"==typeof n:return n.bind(e);case n._proxy&&void 0!==e["$"+t]:return e["$"+t];case void 0===n._proxy&&m2d2.utils.isElement(n):return this.proxy(n);default:return n}},set:(e,t,s)=>{let n="";if(m2d2.utils.isElement(e[t])){let i="";m2d2.utils.isHtml(s)?i="html":m2d2.utils.hasAttrOrProp(e[t],"value")?i="value":(m2d2.utils.isString(s)||m2d2.utils.isNumeric(s))&&(i="text"),i&&(n=e[t][i],e[t][i]=s)}else"onupdate"===t?m2d2.updates?m2d2.utils.isFunction(s)?(e.addEventListener("onupdate",s,!0),n=e[t],e[t]=s):(console.error("Value passed to 'onupdate' is incorrect, in node:"),console.log(e),console.log("Value: (not a function)"),console.log(s)):(console.log("Updates are not available when `m2d2.updates == false`:"),console.log(e)):"items"===t?(e.items.clear(),this.doItems(e,s)):(n=e[t],e[t]=s);return m2d2.updates&&void 0!==e.onupdate&&s!==n&&e.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:t,newValue:s,oldValue:n}})),!0}})}onObserve(e,t){e.forEach(e=>{const t=e.target;if(!(this._storedEvents.indexOf(e)>=0)&&(this._storedEvents.push(e),setTimeout(()=>{const t=this._storedEvents.indexOf(e);t>=0&&this._storedEvents.splice(t,1)},m2d2.storedEventsTimeout),void 0!==t.onupdate))if("attributes"===e.type){const s=m2d2.utils.getAttrOrProp(t,e.attributeName);s!==e.oldValue&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:e.attributeName,newValue:s,oldValue:e.oldValue}}))}else if("childList"===e.type){if("#text"===(e.addedNodes[0]||e.removedNodes[0]).nodeName){const s=e.addedNodes[0].textContent,n=e.removedNodes[0].textContent;s!==n&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:"text",newValue:s,oldValue:n}}))}else if(void 0!==t.items){const s=e.addedNodes,n=e.removedNodes;s!==n&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:"items",newValue:s,oldValue:n}}))}}})}observe(e){if(m2d2.updates){const t=new MutationObserver(this.onObserve.bind(this)),s={attributeOldValue:!0,subtree:!0,childList:!0},n=e._proxy||e;t.observe(n,s)}}getProxyNode(e,t){const s=this.doDom(e,t);return this.observe(s),this.proxy(s)}extendItems(e){function t(t){t.forEach(t=>{const s=t.parentNode.removeChild(t);e.append(s)})}const s=e.items;Object.getOwnPropertyNames(Array.prototype).concat(["clear","get","remove","selected","first","last","findAll"]).forEach(n=>{if(void 0===s[n]){let i=null;const o=this;switch(n){case"copyWithin":case"fill":case"splice":i=function(){console.log("Not available yet: "+n)};break;case"reverse":i=function(...e){if(this.items.length){const s=Array.from(this.items),i=s[n](...e);return t(s),i}};break;case"clear":i=function(){for(;this.items[0];)this.items[0].remove()};break;case"get":i=function(e){let t=null;return this.items.length&&this.items.some(s=>{const n=m2d2.utils.isNumeric(e)?1*s.dataset.id==1*e:s.dataset.id===e;if(s.dataset&&n)return t=s,!0}),t};break;case"selected":i=function(){return o.proxy(this.find(":scope > [selected]"))};break;case"first":i=function(){return o.proxy(this.items[0])};break;case"last":i=function(){return o.proxy(this.items[this.items.length-1])};break;case"pop":i=function(){if(this.items.length){const e=this[0].parentNode;return o.proxy(e.removeChild(this.items[this.items.length-1]))}};break;case"push":i=function(e){if(e instanceof HTMLElement)this.append(e);else if(m2d2.utils.isPlainObject(e)){const t=this.items.length,s=o.getItem(this,t,e);this.appendChild(s)}};break;case"remove":i=function(e){if(this.items.length){const t=this.items.get(e);1===t.length&&t.remove()}};break;case"shift":i=function(){if(this.items.length){const e=this.items[0].parentNode;return o.proxy(e.removeChild(this.items[0]))}};break;case"sort":i=function(e){if(this.items.length){const s=Array.from(this.items);s.sort(e||((e,t)=>e.text.localeCompare(t.text))),t(s)}};break;case"unshift":i=function(e){if(e instanceof HTMLElement)this.prepend(e);else if(m2d2.utils.isPlainObject(e)){const t=this.items.length,s=o.getItem(this,t,e);this.prepend(s)}};break;default:let s=n;switch(!0){case"findAll"===n:s="filter";case"function"==typeof Array.prototype[n]:const t=function(...t){const n=[];return Array.from(e.items).forEach(e=>{n.push(o.proxy(e))}),Array.from(n)[s](...t)};i="find"===n?function(...e){return m2d2.utils.isString(e[0])?this.find(e[0]):t(...e)}:"findAll"===n?function(...e){return 0===e.length?this.findAll():m2d2.utils.isString(e[0])?this.findAll(e[0]):t(...e)}:t}}i&&m2d2.utils.defineProp(s,n,i.bind(e))}})}}