"use strict";class Utils{static sleep(t){return new Promise(e=>setTimeout(e,t))}static htmlNode(t){const e=Utils.newNode("template");return e.innerHTML=t.trim(),e.content.firstChild}static newNode(t){return document.createElement(t)}static node(t,e){return void 0===e&&(e=document),t instanceof Node?t:e.querySelector(t)}static isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}static isSelectorID(t){return 0===(t+"").trim().indexOf("#")}static isPlainObject(t){return Utils.isObject(t)&&!Utils.isArray(t)}static isObject(t){return"object"==typeof t}static isArray(t){return Array.isArray(t)}static isFunction(t){return"function"==typeof t}static isHtml(t){return-1!==(t+"").trim().indexOf("<")}static isEmpty(t){return void 0===t||Utils.isObject(t)&&0===Object.keys(t).length||""===t}}
"use strict";class M2D2{root;constructor(e){this.root=e.root||"body",this.template=e.template||{},this.data=e.data||[],this._init()}static _ext={};static extend(e){Object.assign(M2D2._ext,e)}update(e,t,o){const i=this;if(i._rendered){(function(e){if(void 0!==e._node)if(Utils.isArray(e))if(void 0===o)void 0!==e[t]._node&&e[t]._node.remove();else{const t=[];e._node.childNodes.forEach(e=>{e&&void 0!==e.tagName&&"TEMPLATE"!==e.tagName&&t.push(e)}),t.forEach(e=>{e.remove()}),i._doRender(e._node,e,!1)}else{const s={};t&&(s[t]=o.value,"items"!==t||void 0===e.template||Utils.isEmpty(e.template)||(s.template=e.template),i._doRender(e._node,s,!1))}else i._doRender(i.$root,e,!1)})(e)}}get(){return this._defineProp(this._data,"m2d2",this),this._setProxy(),this._data}clear(){const e=this;e._rendered&&(e.$root.innerHTML=e._cache)}$root=null;_rendered=!1;_updater=!0;_cache=null;_data=null;_htmlGenTags=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","map","mark","menu","meter","nav","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","samp","section","select","small","span","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul","var"];_init(){const e=this;Utils.isObject(e._data)||(e._data={text:e._data}),e._onReady()}_render(){const e=this;if(void 0===e._data)return console.log("data is missing in m2d2 object with root: "+e.root),!1;e._doRender(e.$root,e._data,!1),e._rendered=!0}_onReady(){const e=this;e.$root=Utils.node(e.root),e.$root?(e._cache=e.$root.innerHTML,e._render()):console.log("Warning: Node was not found: "+e.root)}_setProxy(){const e=this;void 0===e._data._proxy&&(Utils.isPlainObject(e._data)||Utils.isArray(e._data))&&(e._data=e._proxy(e._data,(function(t,o,i){"m2d2"!==o&&"_"!==o[0]&&e._updater&&e.update(t,o,i)})))}_doRender(e,t,o){void 0===o&&(o=!1),t&&void 0!==t.oninit&&Utils.isFunction(t.oninit)&&(t.oninit(),delete t.oninit),Utils.isArray(t)&&(t={items:t}),this._setProxy(),this._setValues(e,t,o),t&&void 0!==t.onrender&&Utils.isFunction(t.onrender)&&(t.onrender(),delete t.onrender)}_doArray(e,t,o,i){const s=this;void 0===i&&(i=!1),s._setNode(e,o);let n=s._getTemplate(e,t),l=null;const a=new DocumentFragment;for(let r=0;r<(o.length||Object.keys(o).length);r++){let d=o[r]||Object.values(o)[r];if(void 0!==d._node&&(d._node=void 0),n){let e=n.match(/^<(\w+)>(<\/\w+>)?$/);e&&(l=Utils.newNode(e[1]))}else{if("SELECT"===e.tagName||"DATALIST"===e.tagName)n="<option>","string"==typeof d&&(d={text:d,value:d});else if("UL"===e.tagName||"OL"===e.tagName)n="<li>";else if("NAV"===e.tagName)n="<a>";else{if(!Utils.isPlainObject(d))return console.log("Warning: No template found for object:"),console.log(e),void console.log(t);if(1!==Object.keys(d).length)return console.log("Warning: Multiple keys in data without template is not supported yet. Object:"),void console.log(t);if(Utils.isSelectorID(d)){const e=document.querySelector(d);if(!e)return console.log("Warning: ID selector for template not found: "+d+" . Object:"),void console.log(t);n=e.outerHTML}else n=Utils.newNode(Object.keys(d)[0]).outerHTML}void 0===e._template&&(e._template=n)}l||(l=Utils.htmlNode(n));const c=l.cloneNode(!0);c.setAttribute("data-id",r),s._setValues(c,d,i),a.append(c)}for(;a.firstChild;)e.appendChild(a.firstChild)}_getTemplate(e,t){const o=this;if(void 0!==e._template&&""!==e._template)return e._template;{let i;if(void 0!==t.template?Utils.isPlainObject(t.template)?(i=Utils.newNode("div"),o._setValues(i,t.template,!0)):i=Utils.isSelectorID(t.template)?document.querySelector(t.template):Utils.isHtml(t.template)?Utils.htmlNode("<template>"+t.template+"</template>"):Utils.htmlNode("<template>"+Utils.newNode(t.template).outerHTML+"</template>"):i=Utils.node("template",e),i){const t=i.innerHTML.trim();return o._defineProp(e,"_template",t),t}return e.innerHTML.trim()}}_setValues(e,t,o){const i=this;if(void 0===o&&(o=!1),Utils.isArray(t)&&(t={items:t}),Utils.isPlainObject(t)){i._setNode(e,t),t.hasOwnProperty("html")&&null!==t.html&&i._setValue(e,"html",t.html),t.hasOwnProperty("template")&&(e.append(Utils.htmlNode("<template>"+i._getTemplate(e,t)+"</template>")),t.hasOwnProperty("items")||(t.items=[]));for(let s in t){const n=t[s];if("html"===s||"template"===s||s.startsWith("_"));else if("items"===s)Utils.isArray(n)?i._doArray(e,t,n,o):(console.log("Warning: 'items' specified but value is not and array, in element: "),console.log(e),console.log("Passed values are: "),console.log(n));else if(void 0!==M2D2._ext[s]&&Utils.isFunction(M2D2._ext[s])){const t=M2D2._ext[s](n,e);t&&i._setValues(e,t,o)}else if("#"===s[0])i._doRender(Utils.node(s),n,o);else if(Utils.isArray(n)&&2===n.length&&"object"==typeof n[0]&&"string"==typeof n[1]){let t=n[0]._update||null;void 0===e._orig_update&&(e._orig_update=t,n[0]._update=function(){i._setValue(e,s,n[0][n[1]]),null!==e._orig_update&&e._orig_update()}),i._setValue(e,s,n[0][n[1]])}else if("text"===s&&null!==n)i._setValue(e,s,n);else if("dataset"===s&&Utils.isPlainObject(n))Object.keys(n).forEach(t=>{e.setAttribute("data-"+t,n[t])});else if("style"===s)Utils.isPlainObject(n)?Object.keys(n).forEach(t=>{e.style[t]=n[t]}):e.style=n;else if(s.startsWith("on")&&Utils.isFunction(n))o?(void 0===m2d2.f&&(m2d2.f=[]),m2d2.f.push(n),e.setAttribute(s,"m2d2.f["+(m2d2.f.length-1)+"](event)")):e[s]=n;else if(n instanceof Date)i._hasAttrOrProp(e,s)?e.setAttribute(s,n):i._setValue(e,s,n);else if(!i._hasAttrOrProp(e,s)||Utils.isObject(n)||"id"===s&&Utils.isNumeric(n)){let t=Utils.node(s,e);if(!t&&(t=Utils.node("#"+s,e),t||(t=Utils.node("."+s,e)),t||(t=Utils.node("[name="+s+"]",e)),!t)){const t=function(t,o,s){const n=Utils.newNode(t);e.append(n),i._doRender(n,o,s)};if(-1!==i._htmlGenTags.indexOf(s)){t(s,n,o);continue}if(n&&Utils.isObject(n)&&void 0!==n.tagName){let e=n.tagName;delete n.tagName,t(e,n,o);continue}}t?i._doRender(t,n,o):console.log("No child or attribute found for: "+s+" in element: "+e.localName)}else{try{e[s]=n}catch(t){console.log("Unable to set property ["+s+"] in element: "+e.localName+". Read-only?")}if("boolean"==typeof e[s]&&i._hasAttr(e,s)&&(!0===n?(e.setAttribute(s,n),"autofocus"===s&&e.focus()):e.removeAttribute(s)),"value"===s){let t=e.onchange||null;void 0===e._orig_change&&(e._orig_change=t,e.onchange=function(){this.setAttribute(s,this.value),null!==this._orig_change&&this._orig_change()})}void 0===e._mutable&&(new MutationObserver((function(e){const t=e[0].target;void 0!==t._m2d2?e.forEach(e=>{const s=e.attributeName;let n=t._m2d2[s];const l="boolean"==typeof n?t[s]:t.getAttribute(s);if(void 0!==n&&n!=l){t._m2d2[s]=l;let e={};e[s]=l,i._setValues(t,e,o),void 0!==t._m2d2._update&&t._m2d2._update()}}):console.log("BUG: Unable to find m2d2 reference in node.")})).observe(e,{attributes:!0}),e._mutable=!0)}}}else i._setValue(e,null,t)}_setValue(e,t,o){const i=this;let s=!1;if(null==t?void 0===o||null==o?(console.log("Value was undefined in element :"),console.log(e)):Utils.isPlainObject(o)&&void 0!==o.text?o=o.text:!Utils.isNumeric(o)&&Utils.isHtml(o)&&(s=!0):"html"===t&&(s=!0),s)e.innerHTML=o;else if("value"===t||null==t&&i._hasProp(e,"value")&&"LI"!==e.tagName)i._hasProp(e,"checked")?!0===o||"true"===o||1===o?e.setAttribute("checked",!0):!1===o||"false"===o||0===o?e.setAttribute("checked",!1):e.value=o:o instanceof Date?e.valueAsDate=o:e.value=o;else if(e.childElementCount>0){const t={};try{e.childNodes.forEach(e=>{if(3===e.nodeType)throw e.replaceWith(o),t})}catch(e){if(e!==t)throw e}e.innerHTML=e.innerHTML+o}else e.innerText=o}_hasAttrOrProp(e,t){return this._hasAttr(e,t)||this._hasProp(e,t)}_hasAttr(e,t){let o=!1;if(e&&!Utils.isNumeric(t))switch(t){case"checked":o=void 0!==e.type&&("radio"===e.type||"checkbox"===e.type);break;default:o=e.hasAttribute(t)}return o}_hasProp(e,t){let o=!1;return e&&!Utils.isNumeric(t)&&(o=void 0!==e[t]&&!e.hasAttribute(t)),o}_defineProp(e,t,o){Utils.isObject(e)&&void 0===e[t]&&(Object.defineProperty(e,t,{enumerable:!1,writable:!0}),e[t]=o)}_setNode(e,t){this._defineProp(t,"_node",e),this._defineProp(e,"_m2d2",t)}_proxy(e,t){this._defineProp(e,"_proxy",!0);const o={get:function(t,i,s){if("m2d2"===i||"_"===i[0])return t[i];{const n=Reflect.get(t,i,s),l=Object.getOwnPropertyDescriptor(t,i);if(l&&!l.writable&&!l.configurable)return n;try{return Utils.isArray(e)&&!Utils.isNumeric(i)?t[i]:new Proxy(t[i],o)}catch(e){return n}}},defineProperty:function(e,o,i){return t(e,o,i),Reflect.defineProperty(e,o,i)},deleteProperty:function(e,o){return t(e,o),Reflect.deleteProperty(e,o)},set:function(e,o,i){if(!Utils.isPlainObject(i)||i instanceof M2D2)e[o]=i;else{const t={};Object.keys(i).forEach(e=>{t[e]=i[e]}),e[o]=t}return t(e,o,{value:i}),void 0!==e._update&&e._update(),!0}};return new Proxy(e,o)}set data(e){this._data=e,this.update(this._data)}get data(){return this._data}}const m2d2=function(e,t,o){const i={},s=typeof e;switch(s){case"string":if(void 0===t)return i.data=e,null;i.root=e,Utils.isArray(t)&&(t={items:t}),i.data=t,i.template=o;break;case"object":if(e instanceof Node)i.root=e,e=t;else if(void 0!==e.m2d2)return void e.m2d2.update(t);Utils.isArray(e)&&(t={items:e}),i.data=e,i.template=o;break;default:return console.log("First argument passed to m2d2, with value: ("+e+") is of unknown type: "+s),null}return new M2D2(i).get()};
M2D2.extend({show:function(e,t){const n=function(){return getComputedStyle(t,null).display};if(e){if("none"===n())if(t.dataset._m2d2_display)t.style.display=t.dataset._m2d2_display;else if(t.style.removeProperty("display"),"none"===n()){const e=function(){const e=document.getElementsByTagName("body")[0],n=document.createElement("template"),l=document.createElement(t.tagName);n.appendChild(l),e.appendChild(n);const s=getComputedStyle(l,null).display;return n.remove(),s}();t.style.display=t.dataset.display||("none"!==e?e:"block")}}else{const e="none"!==t.style.display?t.style.display:n();"none"!==e&&(t.dataset._m2d2_display=e),t.style.display="none"}}});
M2D2.extend({color:function(s,t){t.style.color=s},bgcolor:function(s,t){t.style.backgroundColor=s},css:function(s,t){t.className=s},"-css":function(s,t){let l=Utils.isArray(s)?s:s.split(" ");for(let s in l)t.classList.remove(l[s])},"+css":function(s,t){let l=Utils.isArray(s)?s:s.split(" ");for(let s in l)t.classList.add(l[s])}});