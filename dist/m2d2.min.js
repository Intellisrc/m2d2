"use strict";class Utils{isString(t){return"string"==typeof t}isBool(t){return"boolean"==typeof t}isNumeric(t){return!isNaN(parseFloat(t))&&isFinite(t)}isSelectorID(t){return 0===(t+"").trim().indexOf("#")}isPlainObject(t){return"Object"===t.constructor.name}isObject(t){return"object"==typeof t}isArray(t){return Array.isArray(t)}isFunction(t){return"function"==typeof t}isNode(t){return t instanceof HTMLElement}isHtml(t){return-1!==(t+"").trim().indexOf("<")}isEmpty(t){return void 0===t||this.isObject(t)&&0===Object.keys(t).length||""===t}cleanArray(t){return t.filter((function(t){return 0===t||t}))}isValidElement(t){const e=this.newNode(t);return"template"!==t&&"HTMLUnknownElement"!==e.constructor.name}getAttrOrProp(t,e){let r="";return this.hasAttrOrProp(t,e)&&(r=this.hasAttr(t,e)?t.getAttribute(e):t[e]),r}hasAttrOrProp(t,e){return this.hasAttr(t,e)||this.hasProp(t,e)}hasAttr(t,e){let r=!1;if(t&&!this.isNumeric(e))switch(e){case"checked":r=void 0!==t.type&&("radio"===t.type||"checkbox"===t.type);break;default:r=t.hasAttribute(e)}return r}hasProp(t,e){let r=!1;if(t&&!this.isNumeric(e)){let i=void 0!==t[e];i&&null===t[e]&&"value"===e&&(i=!1),r=i&&!(t[e]instanceof Node)&&!t.hasAttribute(e)}return r}setPropOrAttr(t,e,r){if(this.hasProp(t,e))try{t[e]=r}catch(i){this.setAttr(t,e,r)}else this.setAttr(t,e,r)}setAttr(t,e,r){r?t.setAttribute(e,r):t.removeAttribute(e)}defineProp(t,e,r){this.isObject(t)&&void 0===t[e]&&(Object.defineProperty(t,e,{enumerable:!1,writable:!0}),t[e]=r)}htmlNode(t){const e=this.newNode("template");return e.innerHTML=t.trim(),e.content.firstChild}newNode(t){return document.createElement(t)}getMethods(t){const e=Reflect.getPrototypeOf(t),r=Reflect.getPrototypeOf(e);return Reflect.ownKeys(e).filter(t=>Reflect.ownKeys(r).indexOf(t)<0)}}
class m2d2{"use strict";_storedEvents=[];static storedEventsTimeout=50;static short=!0;static updates=!0;static utils=new Utils;constructor(){}static instance=new m2d2;static extensions={};static main=(()=>{const e=(e,t)=>this.instance.getProxyNode(e,t);return m2d2.utils.getMethods(m2d2.utils).forEach(t=>{e[t]=m2d2.utils[t]}),e})();static ready(e){document.addEventListener("DOMContentLoaded",()=>{e(m2d2.main)})}static load(e){const t=e(m2d2.main);m2d2.utils.isObject(t)&&!m2d2.utils.isEmpty(t)&&Object.keys(t).forEach(e=>{if(m2d2.utils.isValidElement(e)){void 0===m2d2.extensions[e]&&(m2d2.extensions[e]={});const s=m2d2.utils.newNode(e);Object.keys(t[e]).forEach(t=>{m2d2.utils.hasProp(s,t)&&console.log("Warning: property ["+t+"] already exists in node: ["+e+"] while trying to extend it. Unexpected behaviour may happen.")}),Object.assign(m2d2.extensions[e],t[e])}else{void 0===m2d2.extensions["*"]&&(m2d2.extensions["*"]={});const s=m2d2.utils.newNode("div");Object.keys(t[e]).forEach(e=>{m2d2.utils.hasProp(s,e)&&console.log("Warning: property ["+e+"] already exists in Node while trying to extend it. Unexpected behaviour may happen.")}),Object.assign(m2d2.extensions["*"],t[e])}})}extDom(e,t){if(!e)return console.error("Selector was empty"),null;void 0===t&&(t=document);const s=m2d2.utils.isNode(e)?e:t.querySelector(e);if(!s)return m2d2.utils.isString(e)?(console.error("Selector: "+e+" didn't match any element in node:"),console.log(t)):console.error("Node was null"),null;if(void 0===s._m2d2){s._m2d2=!0,["find","findAll","onupdate","show","css","text","html","getData"].forEach(e=>{s.hasOwnProperty(e)&&(console.log("Node already had ["+e+"] property. It might cause unexpected behaviour."),console.log("You may need to update the M2D2 version or report it to: github.com/lepe/m2d2/"))}),Object.defineProperty(s,"text",{get(){return this.childNodes.length?this.innerText:this.textContent},set(e){if(this.childNodes.length){let t=!1;this.childNodes.forEach(s=>{"Text"===s.constructor.name&&(s.nodeValue=e,t=!0)}),t||this.prepend(document.createTextNode(e))}else this.textContent=e}}),Object.defineProperty(s,"html",{get(){return this.innerHTML},set(e){this.innerHTML=e}}),Object.defineProperty(s,"css",{get(){return this.classList},set(e){m2d2.utils.isArray(e)?this.className=e.join(" "):m2d2.utils.isString(e)?this.className=e:m2d2.utils.isPlainObject(e)?Object.keys(e).forEach(t=>{e[t]?this.classList.add(t):this.classList.remove(t)}):console.error("Trying to assign a wrong value to css : "+e)}}),Object.defineProperty(s,"show",{get(){const e=this.getBoundingClientRect(),t="none"!==this.style.display,s="hidden"!==this.style.visibility;return t&&s&&e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},set(e){const t=()=>getComputedStyle(this,null).display,s=()=>{const e=document.getElementsByTagName("body")[0],t=document.createElement("template"),s=document.createElement(this.tagName);t.appendChild(s),e.appendChild(t);const i=getComputedStyle(s,null).display;return t.remove(),i};if(e){if("none"===t())if(this._m2d2_display)this.style.display=this._m2d2_display;else if(this.style.removeProperty("display"),"none"===t()){const e=s();this.style.display=this.dataset.display||("none"!==e?e:"block")}}else{const e="none"!==this.style.display?this.style.display:t();"none"!==e&&(this._m2d2_display=e),this.style.display="none"}}});let e={};return void 0!==m2d2.extensions["*"]&&Object.assign(e,m2d2.extensions["*"]),void 0!==m2d2.extensions[s.tagName]&&Object.assign(e,m2d2.extensions[s.tagName]),Object.assign(s,{find:e=>{const t=s.querySelector(e);return t?this.extDom(t):null},findAll:e=>{const t=s.querySelectorAll(e);return t.forEach(e=>{this.extDom(e)}),t}},e),["INPUT","TEXTAREA","SELECT"].indexOf(s.tagName)>=0&&m2d2.utils.hasAttrOrProp(s,"value")&&(s.oninput=function(){this.setAttribute("value",this.value)}),"FORM"===s.tagName&&(s.getData=function(){const e={},t=new FormData(this);for(let s of t.entries())""!==s[1]&&(e[s[0]]=s[1]);return e}),s}return s}doDom(e,t){if(m2d2.utils.isObject(e)&&void 0===t&&(t=e,e="body"),!m2d2.utils.isString(e)&&!m2d2.utils.isNode(e))return console.error("Selector is not a string or a Node:"),console.log(e),null;const s=this.extDom(e);if(void 0===t)return s;if(t=this.plainToObject(s,t),Object.keys(t).forEach(e=>{let i=t[e],o=m2d2.utils.hasProp(s,e),n=!1;if(m2d2.utils.hasAttr(s,e)||o)switch(!0){case"value"===e&&m2d2.utils.hasProp(s,"valueAsDate")&&i instanceof Date:e="valueAsDate";case"css"===e:case typeof i==typeof s[e]:case m2d2.utils.isString(s[e])&&m2d2.utils.isNumeric(i):case m2d2.utils.isFunction(i)&&m2d2.utils.isObject(s[e]):case m2d2.utils.isBool(i)&&m2d2.utils.isString(s[e]):case"object"==typeof s[e]&&"INPUT"===s.tagName:n=!0}if(n){let t=!1;switch(e){case"classList":m2d2.utils.isArray(i)?i.forEach(t=>{s[e].add(t)}):m2d2.utils.isString(i)?s[e].add(i):t=!0;break;case"style":case"dataset":m2d2.utils.isPlainObject(i)?Object.assign(s[e],i):t=!0;break;default:switch(!0){case m2d2.utils.isBool(i):case m2d2.utils.hasAttrOrProp(s,e):m2d2.utils.setPropOrAttr(s,e,i);break;default:s[e]=i}}t&&(console.error("Invalid value passed to '"+e+"': "),console.log(i),console.log("Into Node:"),console.log(s))}else{const o=[];try{if("template"!==e){if(e&&e.match(/^\w/)){let t=s.find("#"+e);t&&-1===o.indexOf(t)&&o.push(t),t=s.find("[name="+e+"]"),t&&-1===o.indexOf(t)&&o.push(t);const i=Array.from(s.findAll("."+e)).filter(e=>o.indexOf(e)<0);i.length>0&&i.forEach(e=>o.push(e))}const t=Array.from(s.findAll(e)).filter(e=>o.indexOf(e)<0);t.length>0&&t.forEach(e=>o.push(e))}}catch(t){return console.error("Invalid selector: "+e),void console.log(t)}if(o.length>1){const n=[];o.forEach(t=>{n.push(this.render(t,e,i))}),this.linkNode(s,e,n),void 0!==t.warn&&!1===t.warn||(console.log("Multiple elements were assigned with key: ["+e+"] under node: "),console.log(s),console.log("It might be what we expect, but if it is not expected it could result on some elements mistakenly rendered. You can specify 'warn : false' under that node to hide this message."))}else if(1===o.length){const n=o[0];if(m2d2.utils.isNode(n))if(m2d2.utils.isArray(i)){const o=t.template;this.doItems(n,i,o),this.linkNode(s,e,n)}else this.renderAndLink(s,n,e,i);else console.error("BUG: It should have been a node but got: "),console.log(n),console.log("Parent node:"),console.log(s)}else if(0===o.length)if("template"===e&&void 0===t.items&&(e="items",i=[]),m2d2.utils.isValidElement(e)){const t=this.appendElement(s,e);this.renderAndLink(s,t,e,i)}else if(void 0!==i.tagName){const t=i.tagName,o=this.appendElement(s,t);delete i.tagName,this.renderAndLink(s,o,e,i)}else if("items"===e){const e=t.template;if(m2d2.utils.isPlainObject(i)){const e=[];Object.keys(i).forEach(t=>{const o={text:i[t]};m2d2.utils.hasAttrOrProp(s,"value")?o.value=t:o.dataset={id:t},e.push(o)}),i=e}m2d2.utils.isArray(i)?this.doItems(s,i,e):(console.log("Warning: 'items' specified but value is not and array, in element: "),console.log(s),console.log("Passed values are: "),console.log(i))}else m2d2.utils.isFunction(i)?m2d2.updates&&("onupdate"===e&&s.addEventListener(e,i,!0),s[e]=i):"template"!==e&&"warn"!==e&&!1!==i&&(void 0!==t.warn&&!1===t.warn||(console.error("Not sure what you want to do with key: "+e+" under element: "),console.log(s),console.log("And object:"),console.log(t),console.log("Most likely the element's property or child no longer exists or the value passed to it is incorrect."),console.log("You can set 'warn : false' property to the element to dismiss this message.")),s[e]=i)}}),s.onload){const e=["BODY","FRAME","IFRAME","IMG","LINK","SCRIPT","STYLE"].indexOf(s.tagName)>=0,t="INPUT"===s.tagName&&"image"===s.type;if(!e&&!t){const e=new CustomEvent("onload");s.addEventListener("onload",s.onload,!0),s.dispatchEvent(e)}}return s}plainToObject(e,t){return m2d2.utils.isPlainObject(t)||m2d2.utils.isFunction(t)||(m2d2.utils.isHtml(t)?t={html:t}:m2d2.utils.hasProp(e,"value")?t={value:t}:m2d2.utils.isString(t)||m2d2.utils.isNumeric(t)?t={text:t}:m2d2.utils.isArray(t)&&(t={items:t})),t}renderAndLink(e,t,s,i){const o=this.render(t,s,i);this.linkNode(e,s,o)}render(e,t,s){return s=this.plainToObject(e,s),this.doDom(e,s)}linkNode(e,t,s){if(e[t]===s){const i=this.proxy(s);try{e[t]=i}catch(e){}e["$"+t]=i}else m2d2.utils.hasAttrOrProp(e,t)?(e["$"+t]=s,console.log("Property : "+t+" existed in node: "+e.tagName+". Using $"+t+" instead for node: "+s.tagName+".")):e[t]=this.proxy(s)}appendElement(e,t){const s=m2d2.utils.newNode(t);return e.append(s),s}getItem(e,t,s,i){i||(i=this.getTemplate(e));const o=i.cloneNode(!0);o.dataset.id=t,this.setUniqueAttrib(o,"selected");let n=this.doDom(o,s);return this.getItemWithEvents(e,n)}getItemWithEvents(e,t){if(void 0!==e.__template){const s=(e,t)=>(t=t||{},Object.keys(e).forEach(i=>{m2d2.utils.isPlainObject(e[i])?t[i]=s(e[i]):m2d2.utils.isFunction(e[i])&&(t[i]=e[i])}),t);let i=s(e.__template);m2d2.utils.isEmpty(i)||(i=i[Object.keys(i)[0]],t=this.doDom(t,i))}return t}doItems(e,t,s){const i=this.getTemplate(e,s);if(void 0===i)return console.error("Template not found. Probably an array is being used where it is not expected. Node:"),console.log(e),console.log("Value (mistaken?):"),void console.log(t);const o=new DocumentFragment;let n=0;for(t.forEach(t=>{t=this.plainToObject(e,t);const s=this.getItem(e,n++,t,i);o.appendChild(s)});o.firstChild;)e.appendChild(o.firstChild);const l=e.find("template");l&&e.removeChild(l),e.items=e.children,this.extendItems(e)}getTemplate(e,t){if(void 0!==e._template&&""!==e._template)return e._template;{let s;if(t){if(m2d2.utils.isPlainObject(t)){const i=m2d2.utils.newNode("template");s=this.doDom(i,t),m2d2.utils.defineProp(e,"__template",t)}else s=m2d2.utils.isHtml(t)?m2d2.utils.htmlNode("<div>"+t+"</div>"):m2d2.utils.isSelectorID(t)?document.querySelector(t):m2d2.utils.newNode(t);s&&s.childElementCount>0&&(s=s.firstChild)}else if(e.find("template"))s=m2d2.utils.htmlNode(this.getNode("template",e).innerHTML);else switch(e.tagName){case"SELECT":case"DATALIST":s=m2d2.utils.newNode("option");break;case"UL":case"OL":s=m2d2.utils.newNode("li");break;case"NAV":s=m2d2.utils.newNode("a");break;case"DL":s=m2d2.utils.htmlNode("<dt></dt><dd></dd>");break;default:e.childElementCount>0&&(s=e.firstChild.cloneNode(!0))}return s&&m2d2.utils.defineProp(e,"_template",s),s}}setUniqueAttrib(e,t){e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:function(){return this.hasAttribute(t)},set:function(e){const s=this.parentNode?this.parentNode.find("["+t+"]"):null;s&&s.removeAttribute(t),m2d2.utils.setAttr(this,t,e)}})}getNode(e,t){return void 0===t&&(t=document),e instanceof Node?e:t.querySelector(e)}proxy(e,t){if(!m2d2.short||null===e||void 0!==e._proxy&&void 0===t)return e;e._proxy=e;return new Proxy(e,{get:(e,t,s)=>{const i=e[t];switch(!0){case null==i:return null;case"function"==typeof i:return i.bind(e);case i._proxy&&void 0!==e["$"+t]:return e["$"+t];case void 0===i._proxy&&m2d2.utils.isNode(i):return this.proxy(i);default:return i}},set:(e,t,s)=>{let i="";if(m2d2.utils.isNode(e[t])){let o="";m2d2.utils.isHtml(s)?o="html":m2d2.utils.hasAttrOrProp(e[t],"value")?o="value":(m2d2.utils.isString(s)||m2d2.utils.isNumeric(s))&&(o="text"),o&&(i=e[t][o],e[t][o]=s)}else"onupdate"===t?m2d2.updates?m2d2.utils.isFunction(s)?(e.addEventListener("onupdate",s,!0),i=e[t],e[t]=s):(console.error("Value passed to 'onupdate' is incorrect, in node:"),console.log(e),console.log("Value: (not a function)"),console.log(s)):(console.log("Updates are not available when `m2d2.updates == false`:"),console.log(e)):"items"===t?(e.items.clear(),this.doItems(e,s)):(i=e[t],e[t]=s);return m2d2.updates&&void 0!==e.onupdate&&s!==i&&e.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:t,newValue:s,oldValue:i}})),!0}})}onObserve(e,t){e.forEach(e=>{const t=e.target;if(!(this._storedEvents.indexOf(e)>=0)&&(this._storedEvents.push(e),setTimeout(()=>{const t=this._storedEvents.indexOf(e);t>=0&&this._storedEvents.splice(t,1)},m2d2.storedEventsTimeout),void 0!==t.onupdate))if("attributes"===e.type){const s=m2d2.utils.getAttrOrProp(t,e.attributeName);s!==e.oldValue&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:e.attributeName,newValue:s,oldValue:e.oldValue}}))}else if("childList"===e.type){if("#text"===(e.addedNodes[0]||e.removedNodes[0]).nodeName){const s=e.addedNodes[0].textContent,i=e.removedNodes[0].textContent;s!==i&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:"text",newValue:s,oldValue:i}}))}else if(void 0!==t.items){const s=e.addedNodes,i=e.removedNodes;s!==i&&t.dispatchEvent(new CustomEvent("onupdate",{detail:{type:typeof s,property:"items",newValue:s,oldValue:i}}))}}})}observe(e){if(m2d2.updates){const t=new MutationObserver(this.onObserve.bind(this)),s={attributeOldValue:!0,subtree:!0,childList:!0},i=e._proxy||e;t.observe(i,s)}}getProxyNode(e,t){const s=this.doDom(e,t);return this.observe(s),this.proxy(s)}extendItems(e){function t(t){t.forEach(t=>{const s=t.parentNode.removeChild(t);e.appendChild(s)})}const s=e.items;Object.getOwnPropertyNames(Array.prototype).concat(["clear","get","remove","selected","first","last"]).forEach(i=>{if(void 0===s[i]){let o=null;const n=this;switch(i){case"copyWithin":case"fill":case"splice":case"reverse":o=function(...e){if(this.items.length){const s=Array.from(this.items),o=s[i](...e);return t(s),o}};break;case"clear":o=function(){for(;this.items[0];)this.items[0].remove()};break;case"get":o=function(e){let t=null;return this.items.length&&this.items.some(s=>{if(s.dataset&&1*s.dataset.id==1*e)return t=s,!0}),t};break;case"selected":o=function(){return n.proxy(this.find("[selected]"))};break;case"first":o=function(){return n.proxy(this.items[0])};break;case"last":o=function(){return n.proxy(this.items[this.items.length-1])};break;case"pop":o=function(){if(this.items.length){const e=this[0].parentNode;return n.proxy(e.removeChild(this.items[this.items.length-1]))}};break;case"push":o=function(e){if(e instanceof HTMLElement)this.appendChild(e);else if(m2d2.utils.isPlainObject(e)){const t=this.items.length,s=n.getItem(this,t,e);this.appendChild(s)}};break;case"remove":o=function(e){this.items.length&&this.items.some(t=>{if(t.dataset&&1*t.dataset.id==1*e)return t.remove(),!0})};break;case"shift":o=function(){if(this.items.length){const e=this.items[0].parentNode;return n.proxy(e.removeChild(this.items[0]))}};break;case"sort":o=function(e){if(this.items.length){const s=Array.from(this.items);s.sort(e||((e,t)=>e.text.localeCompare(t.text))),t(s)}};break;case"unshift":o=function(e){if(e instanceof HTMLElement)this.prepend(e);else if(m2d2.utils.isPlainObject(e)){const t=this.items.length,s=n.getItem(this,t,e);this.prepend(s)}};break;default:"function"==typeof Array.prototype[i]&&(o=function(...t){const s=[];return Array.from(e.items).forEach(e=>{s.push(n.proxy(e))}),Array.from(s)[i](...t)})}o&&m2d2.utils.defineProp(s,i,o.bind(e))}})}}