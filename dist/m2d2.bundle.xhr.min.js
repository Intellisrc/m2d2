/**
 * Author : A.Lepe (dev@alepe.com) - intellisrc.com
 * License: MIT
 * Version: 2.1.1
 * Updated: 2022-02-16
 * Content: XHR Bundle
 */

!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.m2d2=t()}(this,(function(){"use strict";class e{isString(e){return"string"==typeof e}isBool(e){return"boolean"==typeof e}isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}isSelectorID(e){return 0===(e+"").trim().indexOf("#")}isPlainObject(e){return"Object"===e.constructor.name}isObject(e){return"object"==typeof e}isArray(e){return Array.isArray(e)}isFunction(e){return"function"==typeof e}isElement(e){return e instanceof HTMLElement}isNode(e){return e instanceof Node||e instanceof DocumentFragment}isHtml(e){return-1!==(e+"").trim().indexOf("<")}isEmpty(e){return void 0===e||this.isObject(e)&&0===Object.keys(e).length||""===e}cleanArray(e){return e.filter((function(e){return 0===e||e}))}isValidElement(e){const t=this.newElement(e);return"template"!==e&&"HTMLUnknownElement"!==t.constructor.name}exists(e){return null!==document.querySelector(e)}getAttrOrProp(e,t){let n="";return this.hasAttrOrProp(e,t)&&(n=this.hasAttr(e,t)?e.getAttribute(t):e[t]),n}hasAttrOrProp(e,t){return this.hasAttr(e,t)||this.hasProp(e,t)}hasAttr(e,t){let n=!1;if(e&&!this.isNumeric(t))switch(t){case"checked":n=void 0!==e.type&&("radio"===e.type||"checkbox"===e.type);break;default:n=void 0!==e.hasAttribute&&e.hasAttribute(t)}return n}hasProp(e,t){let n=!1;if(e&&!this.isNumeric(t)){let s=void 0!==e[t];s&&null===e[t]&&"value"===t&&(s=!1),n=s&&!(e[t]instanceof Node)&&!e.hasAttribute(t)}return n}setPropOrAttr(e,t,n){if(this.hasProp(e,t))try{e[t]=n}catch(s){this.setAttr(e,t,n)}else this.setAttr(e,t,n)}setAttr(e,t,n){n?e.setAttribute(t,n):e.removeAttribute(t)}defineProp(e,t,n){this.isObject(e)&&void 0===e[t]&&(Object.defineProperty(e,t,{enumerable:!1,writable:!0}),e[t]=n)}htmlElement(e){const t=this.newElement("template");return t.innerHTML=e.trim(),t.content.firstChild}newElement(e){return document.createElement(e)}newEmptyNode(){return new DocumentFragment}getMethods(e){const t=Reflect.getPrototypeOf(e),n=Reflect.getPrototypeOf(t);return Reflect.ownKeys(t).filter(e=>Reflect.ownKeys(n).indexOf(e)<0)}appendAllChild(e,t){for(;e.firstChild;)t.append(e.firstChild)}prependAllChild(e,t){for(;e.firstChild;)t.prepend(e.firstChild)}}class t{"use strict";_storedEvents=[];static storedEventsTimeout=50;static short=!0;static updates=!0;static utils=new e;constructor(){}static instance=new t;static extensions={};static main=(()=>{const e=(e,n)=>{const s=this.instance.getProxyNode(e,n);return void 0!==s.onready&&t.utils.isFunction(s.onready)&&(s.addEventListener("ready",s.onready,{once:!0}),setTimeout(()=>{s.dispatchEvent(new CustomEvent("ready"))},10)),s};return t.utils.getMethods(t.utils).forEach(n=>{e[n]=t.utils[n]}),e})();static ready(e){document.addEventListener("DOMContentLoaded",()=>{e(t.main)})}static load(e){if(void 0!==e){const n=e(t.main);t.utils.isObject(n)&&!t.utils.isEmpty(n)&&Object.keys(n).forEach(e=>{if(t.utils.isValidElement(e)){void 0===t.extensions[e]&&(t.extensions[e]={});const s=t.utils.newElement(e);Object.keys(n[e]).forEach(n=>{t.utils.hasProp(s,n)&&console.log("Warning: property ["+n+"] already exists in node: ["+e+"] while trying to extend it. Unexpected behaviour may happen.")}),Object.assign(t.extensions[e],n[e])}else{void 0===t.extensions["*"]&&(t.extensions["*"]={});const s=t.utils.newElement("div");Object.keys(n[e]).forEach(e=>{t.utils.hasProp(s,e)&&console.log("Warning: property ["+e+"] already exists in Node while trying to extend it. Unexpected behaviour may happen.")}),Object.assign(t.extensions["*"],n[e])}})}return t.main}extDom(e,n){if(!e)return console.error("Selector was empty"),null;void 0===n&&(n=document);const s=t.utils.isNode(e)?e:n.querySelector(e);if(!s)return t.utils.isString(e)?(console.error("Selector: "+e+" didn't match any element in node:"),console.log(n)):console.error("Node was null"),null;if(void 0===s._m2d2){s._m2d2=!0,["parent","sibling","find","findAll","onupdate","onready","show","onshow","css","text","html","getData"].forEach(e=>{s.hasOwnProperty(e)&&(console.log("Node already had ["+e+"] property. It might cause unexpected behaviour."),console.log("You may need to update the M2D2 version or report it to: github.com/intellisrc/m2d2/"))}),Object.defineProperty(s,"text",{get(){return this.childNodes.length?this.innerText:this.textContent},set(e){if(this.childNodes.length){let t=!1;this.childNodes.forEach(n=>{"Text"===n.constructor.name&&(n.nodeValue=e,t=!0)}),t||this.prepend(document.createTextNode(e))}else this.textContent=e}}),Object.defineProperty(s,"html",{get(){return this.innerHTML},set(e){this.innerHTML=e}}),Object.defineProperty(s,"css",{get(){return this.classList},set(e){t.utils.isArray(e)?this.className=e.join(" "):t.utils.isString(e)?this.className=e:t.utils.isPlainObject(e)?Object.keys(e).forEach(t=>{e[t]?this.classList.add(t):this.classList.remove(t)}):console.error("Trying to assign a wrong value to css : "+e)}}),Object.defineProperty(s,"show",{get(){const e=this.getBoundingClientRect(),t="none"!==this.style.display,n="hidden"!==this.style.visibility;return t&&n&&e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)&&e.width>0&&e.height>0},set(e){const n=()=>getComputedStyle(this,null).display,s=()=>{const e=document.getElementsByTagName("body")[0],t=document.createElement("template"),n=document.createElement(this.tagName);t.append(n),e.append(t);const s=getComputedStyle(n,null).display;return t.remove(),s};if(e){if("none"===n()){if(this._m2d2_display)this.style.display=this._m2d2_display;else if(this.style.removeProperty("display"),"none"===n()){const e=s();this.style.display=this.dataset.display||("none"!==e?e:"block")}void 0!==this.onshow&&t.utils.isFunction(this.onshow)&&this.onshow(this)}}else{const e="none"!==this.style.display?this.style.display:n();"none"!==e&&(this._m2d2_display=e),this.style.display="none"}}});let e={};return void 0!==t.extensions["*"]&&Object.assign(e,t.extensions["*"]),void 0!==t.extensions[s.tagName]&&Object.assign(e,t.extensions[s.tagName]),Object.assign(s,{parent:()=>this.extDom(s.parentElement),sibling:e=>s.parentElement.find(e),find:e=>{const t=s.querySelector(e);return t?this.extDom(t):null},findAll:e=>{const t=void 0===e?Array.from(s.children):s.querySelectorAll(e);return t.forEach(e=>{this.extDom(e)}),t}},e),["INPUT","TEXTAREA","SELECT"].indexOf(s.tagName)>=0&&t.utils.hasAttrOrProp(s,"value")&&(s.oninput=function(){this.setAttribute("value",this.value)}),"FORM"===s.tagName&&(s.getData=function(e){const t={},n=new FormData(this),o=e||!1;for(let e of n.entries()){const n=s.find("[name='"+e[0]+"']");(o||"hidden"===n.type||n.show)&&(t[e[0]]="file"===n.type?n.files:e[1])}return t}),s}return s}doDom(e,n){if(t.utils.isObject(e)&&void 0===n&&(n=e,e="body"),!(t.utils.isString(e)||t.utils.isElement(e)||t.utils.isNode(e)))return console.error("Selector is not a string or a Node:"),console.log(e),null;if(t.utils.isString(e)&&!document.querySelector(e))return console.log("Selected element doesn't exists: "+e),null;const s=this.extDom(e);if(void 0===n)return s;if(n=this.plainToObject(s,n),Object.keys(n).filter(e=>!["tagName"].includes(e)).forEach(e=>{let o=n[e];null==o&&(console.log("Value was not set for key: "+e+", 'empty' was used in object: "),console.log(n),console.log("In node:"),console.log(s),o="");let i=t.utils.hasProp(s,e),l=!1;if(t.utils.hasAttr(s,e)||i)switch(!0){case"value"===e&&t.utils.hasProp(s,"valueAsDate")&&o instanceof Date:e="valueAsDate";case"css"===e:case typeof o==typeof s[e]:case t.utils.isString(s[e])&&t.utils.isNumeric(o):case t.utils.isFunction(o)&&t.utils.isObject(s[e]):case t.utils.isBool(o)&&t.utils.isString(s[e]):case"object"==typeof s[e]&&"INPUT"===s.tagName:l=!0}if(l){let n=!1;switch(e){case"classList":t.utils.isArray(o)?o.forEach(t=>{s[e].add(t)}):t.utils.isString(o)?s[e].add(o):n=!0;break;case"style":case"dataset":t.utils.isPlainObject(o)?Object.assign(s[e],o):n=!0;break;default:switch(!0){case t.utils.isBool(o):case t.utils.hasAttrOrProp(s,e):t.utils.setPropOrAttr(s,e,o);break;default:s[e]=o}}n&&(console.error("Invalid value passed to '"+e+"': "),console.log(o),console.log("Into Node:"),console.log(s))}else{const i=[];try{if("template"!==e&&!t.utils.isFunction(o)){if(e&&e.match(/^\w/)){let t=s.find("#"+e);t&&-1===i.indexOf(t)&&i.push(t),t=s.find("[name='"+e+"']"),t&&-1===i.indexOf(t)&&i.push(t);const n=Array.from(s.findAll("."+e)).filter(e=>i.indexOf(e)<0);n.length>0&&n.forEach(e=>i.push(e))}const t=Array.from(s.findAll(e)).filter(e=>i.indexOf(e)<0);t.length>0&&t.forEach(e=>i.push(e))}}catch(t){return console.error("Invalid selector: "+e),void console.log(t)}if(i.length>1){const t=[];i.forEach(n=>{t.push(this.render(n,e,o))}),this.linkNode(s,e,t),void 0!==o.warn&&!1===o.warn||(console.log("Multiple elements were assigned with key: ["+e+"] under node: "),console.log(s),console.log("It might be what we expect, but if it is not expected it could result on some elements mistakenly rendered. You can specify 'warn : false' under that element to hide this message."))}else if(1===i.length){const l=i[0];if(t.utils.isElement(l))if(t.utils.isArray(o)){const t=n.template;this.doItems(l,o,t),this.linkNode(s,e,l)}else this.renderAndLink(s,l,e,o);else console.error("BUG: It should have been a node but got: "),console.log(l),console.log("Parent node:"),console.log(s)}else if(0===i.length){"template"===e&&void 0===n.items&&(e="items",o=[]);const i=t.utils.isFunction(o);if(void 0!==o.tagName){const t=this.appendElement(s,o.tagName);this.renderAndLink(s,t,e,o)}else if(t.utils.isValidElement(e)&&!i){const t=this.appendElement(s,e);this.renderAndLink(s,t,e,o)}else if("items"===e){const e=n.template;if(t.utils.isPlainObject(o)){const e=[];Object.keys(o).forEach(n=>{let i;"DL"===s.tagName?i={dt:n,dd:o[n]}:(i={text:o[n]},t.utils.hasAttrOrProp(s,"value")?i.value=n:i.dataset={id:n}),e.push(i)}),o=e}t.utils.isArray(o)?this.doItems(s,o,e):(console.log("Warning: 'items' specified but value is not and array, in element: "),console.log(s),console.log("Passed values are: "),console.log(o))}else i?(t.updates&&"onupdate"===e&&s.addEventListener("update",o,!0),s[e]=o):"template"!==e&&"warn"!==e&&!1!==o&&(void 0!==n.warn&&!1===n.warn||(console.error("Not sure what you want to do with key: "+e+" under element: "),console.log(s),console.log("And object:"),console.log(n),console.log("Most likely the element's property or child no longer exists or the value passed to it is incorrect."),console.log("You can set 'warn : false' property to the element to dismiss this message.")),s[e]=o)}}}),s.onload){const e=["BODY","FRAME","IFRAME","IMG","LINK","SCRIPT","STYLE"].indexOf(s.tagName)>=0,t="INPUT"===s.tagName&&"image"===s.type;e||t||(s.addEventListener("load",s.onload,{once:!0}),s.dispatchEvent(new CustomEvent("load")))}return s}plainToObject(e,n){return t.utils.isPlainObject(n)||t.utils.isFunction(n)||n instanceof HTMLElement||(t.utils.isHtml(n)?n={html:n}:t.utils.isArray(n)?n={items:n}:t.utils.hasAttrOrProp(e,"value")?n="SELECT"===e.tagName?{value:n,text:n}:"BUTTON"===e.tagName?{text:n}:{value:n}:t.utils.isString(n)&&"IMG"===e.tagName?n={src:n}:(t.utils.isString(n)||t.utils.isNumeric(n))&&(n={text:n})),n}renderAndLink(e,t,n,s){const o=this.render(t,n,s);this.linkNode(e,n,o)}render(e,t,n){return n=this.plainToObject(e,n),this.doDom(e,n)}linkNode(e,n,s){if(e[n]===s){const t=this.proxy(s);try{e[n]=t}catch(e){}e["$"+n]=t}else t.utils.hasAttrOrProp(e,n)?(e["$"+n]=s,console.log("Property : "+n+" existed in node: "+e.tagName+". Using $"+n+" instead for node: "+s.tagName+".")):e[n]=this.proxy(s)}appendElement(e,n){const s=t.utils.newElement(n);return e.append(s),s}getItem(e,t,n,s){s||(s=this.getTemplate(e));const o=s.cloneNode(!0);this.addTemplatesToItem(s,o),o.dataset.id=t,this.setUniqueAttrib(o,"selected");let i=this.doDom(o,n);return this.getItemWithEvents(e,i)}addTemplatesToItem(e,t){["_template","__template"].forEach(n=>{void 0!==e[n]&&(t[n]=e[n])})}getItemWithEvents(e,n){if(void 0!==e.__template){const s=(e,n)=>(n=n||{},Object.keys(e).forEach(o=>{t.utils.isPlainObject(e[o])?n[o]=s(e[o]):t.utils.isFunction(e[o])&&(n[o]=e[o])}),n);let o=s(e.__template);t.utils.isEmpty(o)||(o=o[Object.keys(o)[0]],n=this.doDom(n,o))}return n}doItems(e,t,n){const s=this.getTemplate(e,n);if(void 0===s)return console.error("Template not found. Probably an array is being used where it is not expected. Node:"),console.log(e),console.log("Value (mistaken?):"),void console.log(t);let o=0;t.forEach(t=>{t=this.plainToObject(e,t);const n=this.getItem(e,o++,t,s);n&&e.append(n)});const i=e.find("template");i&&e.removeChild(i),e.items=e.children,this.extendItems(e)}getTemplate(e,n){if(void 0!==e._template&&""!==e._template)return e._template;{let s;const o=e.querySelector("template");if(o)s=t.utils.htmlElement(o.innerHTML.trim());else switch(e.tagName){case"SELECT":case"DATALIST":s=t.utils.newElement("option");break;case"UL":case"OL":s=t.utils.newElement("li");break;case"NAV":s=t.utils.newElement("a");break;case"DL":s=t.utils.newElement("dd");break;default:if(n){const o=Object.keys(n).length;if(o){if(o>1)if(void 0!==n.tagName){let e={};e[n.tagName]=n,n=e}else console.log("Template has more than one top elements. Using the first one. In: "),console.log(n),console.log("Node: "),console.log(e);const i=Object.keys(n)[0],l=n[i];t.utils.isValidElement(i)?s=t.utils.newElement(i):void 0!==l.tagName?s=t.utils.newElement(l.tagName):(console.error("Template defined an element which can not be identified: ["+i+"], using <span> in:"),console.log(n),console.log("Node: "),console.log(e),s=t.utils.newElement("span"))}else console.error("Template has no definition and it can not be guessed. Using <span>. Template: "),console.log(n),console.log("Node: "),console.log(e),s=t.utils.newElement("span")}else e.childElementCount>0&&(s=t.utils.htmlElement(e.innerHTML.trim()))}if(n)if(t.utils.isPlainObject(n)){const o=t.utils.newEmptyNode();o.append(s),s=this.doDom(o,n).children[0],t.utils.defineProp(e,"__template",n)}else s=t.utils.isHtml(n)?t.utils.htmlElement(n):t.utils.isSelectorID(n)?t.utils.htmlElement(document.querySelector(n).innerHTML):t.utils.newElement(n);if(s.childrenElementCount>1){console.log("Templates only supports a single child. Multiple children were detected, wrapping them with <span>. Template:"),console.log(s);const e=t.utils.newElement("span");e.append(s),s=e}return s&&t.utils.defineProp(e,"_template",s),s}}setUniqueAttrib(e,n){e.hasOwnProperty(n)||Object.defineProperty(e,n,{get:function(){return this.hasAttribute(n)},set:function(e){const s=this.parentNode?this.parentNode.find("["+n+"]"):null;s&&s.removeAttribute(n),t.utils.setAttr(this,n,e)}})}getNode(e,t){return void 0===t&&(t=document),e instanceof Node?e:t.querySelector(e)}proxy(e,n){return!t.short||null===e||void 0!==e._proxy&&void 0===n?e:(e._proxy=e,new Proxy(e,{get:(e,n)=>{const s=e[n];switch(!0){case null==s:return null;case"function"==typeof s:return s.bind(e);case s._proxy&&void 0!==e["$"+n]:return e["$"+n];case void 0===s._proxy&&t.utils.isElement(s):return this.proxy(s);default:return s}},set:(e,n,s)=>{let o="";if(t.utils.isElement(e[n])){let i="";t.utils.isHtml(s)?i="html":t.utils.hasAttrOrProp(e[n],"value")?i="value":t.utils.isString(s)&&"IMG"===e[n].tagName?i="src":(t.utils.isString(s)||t.utils.isNumeric(s))&&(i="text"),i&&(o=e[n][i],e[n][i]=s)}else"onupdate"===n?t.updates?t.utils.isFunction(s)?(e.addEventListener("update",s,!0),o=e[n],e[n]=s):(console.error("Value passed to 'onupdate' is incorrect, in node:"),console.log(e),console.log("Value: (not a function)"),console.log(s)):(console.log("Updates are not available when `m2d2.updates == false`:"),console.log(e)):"items"===n?(e.items.clear(),this.doItems(e,s)):(o=e[n],e[n]=s);return t.updates&&void 0!==e.onupdate&&s!==o&&e.dispatchEvent(new CustomEvent("update",{detail:{type:typeof s,property:n,newValue:s,oldValue:o}})),!0}}))}onObserve(e,n){e.forEach(e=>{const n=e.target;if(!(this._storedEvents.indexOf(e)>=0)&&(this._storedEvents.push(e),setTimeout(()=>{const t=this._storedEvents.indexOf(e);t>=0&&this._storedEvents.splice(t,1)},t.storedEventsTimeout),void 0!==n.onupdate))if("attributes"===e.type){const s=t.utils.getAttrOrProp(n,e.attributeName);s!==e.oldValue&&n.dispatchEvent(new CustomEvent("update",{detail:{type:typeof s,property:e.attributeName,newValue:s,oldValue:e.oldValue}}))}else if("childList"===e.type)if("#text"===(e.addedNodes[0]||e.removedNodes[0]).nodeName){const t=e.addedNodes[0].textContent,s=e.removedNodes[0].textContent;t!==s&&n.dispatchEvent(new CustomEvent("update",{detail:{type:typeof t,property:"text",newValue:t,oldValue:s}}))}else if(void 0!==n.items){const t=e.addedNodes,s=e.removedNodes;t!==s&&n.dispatchEvent(new CustomEvent("update",{detail:{type:typeof t,property:"items",newValue:t,oldValue:s}}))}})}observe(e){if(t.updates){const t=new MutationObserver(this.onObserve.bind(this)),n={attributeOldValue:!0,subtree:!0,childList:!0},s=e._proxy||e;t.observe(s,n)}}getProxyNode(e,t){const n=this.doDom(e,t);if(n)return this.observe(n),this.proxy(n)}extendItems(e){function n(t){t.forEach(t=>{const n=t.parentNode.removeChild(t);e.append(n)})}const s=e.items;Object.getOwnPropertyNames(Array.prototype).concat(["clear","get","remove","selected","first","last","findAll"]).forEach(o=>{if(void 0===s[o]){let i=null;const l=this;switch(o){case"copyWithin":case"fill":case"splice":i=function(){console.log("Not available yet: "+o)};break;case"reverse":i=function(...e){if(this.items.length){const t=Array.from(this.items),s=t[o](...e);return n(t),s}};break;case"clear":i=function(){for(;this.items[0];)this.items[0].remove()};break;case"get":i=function(e){let n=null;return this.items.length&&this.items.some(s=>{const o=t.utils.isNumeric(e)?1*s.dataset.id==1*e:s.dataset.id===e;if(s.dataset&&o)return n=s,!0}),n};break;case"selected":i=function(){return l.proxy(this.find(":scope > [selected]"))};break;case"first":i=function(){return l.proxy(this.items[0])};break;case"last":i=function(){return l.proxy(this.items[this.items.length-1])};break;case"pop":i=function(){if(this.items.length){const e=this[0].parentNode;return l.proxy(e.removeChild(this.items[this.items.length-1]))}};break;case"push":i=function(e){if((e=l.plainToObject(this,e))instanceof HTMLElement)this.append(e);else if(t.utils.isPlainObject(e)){const t=this.items.length,n=l.getItem(this,t,e);this.appendChild(n)}else console.log("Trying to push an unknown value into a list:"),console.log(e)};break;case"remove":i=function(e){if(this.items.length){const t=this.items.get(e);1===t.length&&t.remove()}};break;case"shift":i=function(){if(this.items.length){const e=this.items[0].parentNode;return l.proxy(e.removeChild(this.items[0]))}};break;case"sort":i=function(e){if(this.items.length){const t=Array.from(this.items);t.sort(e||((e,t)=>e.text.localeCompare(t.text))),n(t)}};break;case"unshift":i=function(e){if((e=l.plainToObject(this,e))instanceof HTMLElement)this.prepend(e);else if(t.utils.isPlainObject(e)){const t=this.items.length,n=l.getItem(this,t,e);this.prepend(n)}else console.log("Trying to unshift an unknown value into a list:"),console.log(e)};break;default:let s=o;switch(!0){case"findAll"===o:s="filter";case"function"==typeof Array.prototype[o]:const n=function(...t){const n=[];return Array.from(e.items).forEach(e=>{n.push(l.proxy(e))}),Array.from(n)[s](...t)};switch(o){case"find":i=function(...e){return t.utils.isString(e[0])?this.find(e[0]):n(...e)};break;case"findAll":i=function(...e){return 0===e.length?this.findAll():t.utils.isString(e[0])?this.findAll(e[0]):n(...e)};break;case"concat":i=function(...e){for(let n=0;n<e.length;n++)if(t.utils.isArray(e[n]))for(let s=0;s<e[n].length;s++){let o=e[n][s];if(!(o instanceof HTMLElement)&&(o=l.plainToObject(this,e[n][s]),t.utils.isPlainObject(o))){const e=this.items.length;o=l.getItem(this,e,o)}this.items.push(o)}};break;default:i=n}}}i&&t.utils.defineProp(s,o,i.bind(e))}})}}return t.load(e=>{function t(t){e.exists("#m2d2-alert .m2d2-alert-front")?(e("#m2d2-alert .m2d2-alert-front").css.add("vanish"),setTimeout(()=>{e.exists("#m2d2-alert .m2d2-alert-front")&&e("#m2d2-alert").remove(),t&&t()},400)):t&&t()}function n(e){let t=[];switch(e){case"question":t=["fa","fa-question-circle"];break;case"info":t=["fa","fa-exclamation-circle"];break;case"error":t=["fa","fa-exclamation-triangle"];break;case"ok":t=["fa","fa-check"];break;case"input":t=["fa","fa-edit"];break;case"wait":t=["fa","fa-cog","fa-spin"]}return t}e.message=function(s){if(s&&(e.isFunction(s.callback)||(s.callback&&!s.text&&(s.text=s.callback),s.callback=()=>{}),s.text||(s.text="")),t(()=>{e("body",{m2d2Alert:{tagName:"div",id:"m2d2-alert",back:{tagName:"div",css:"m2d2-alert-back",style:{position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:"#0005",display:"flex",justifyContent:"center",alignItems:"center"},front:{tagName:"form",css:(s.css?e.isArray(s.css)?s.css:[s.css]:[]).concat(["m2d2-alert-front","popup",s.icon],n(s.icon)),style:{zIndex:100},message:{tagName:"div",css:"m2d2-alert-title",span:s.title},submsg:(()=>{let t;return t="input"!==s.icon||s.text?e.isPlainObject(s.text)?{fieldset:Object.assign({css:"m2d2-alert-field"},s.text)}:{span:s.text.replace("\n","<br>")}:{fieldset:{css:"m2d2-alert-field",input:{type:"text",name:"answer",onload:function(){this.focus()}}}},Object.assign({tagName:"div",css:"m2d2-alert-text"},t)})(s.icon),onsubmit:function(){const e=this.getData();let n;switch(e.button){case"ok":case"yes":n=()=>{s.callback(!0,e)};break;case"no":n=()=>{s.callback(!1,e)};break;case"cancel":n=()=>{s.callback(null,e)};break;case"send":n=1===Object.keys(e).length?()=>{s.callback(e[Object.keys(e)[0]],e)}:2===Object.keys(e).length?()=>{s.callback(e[Object.keys(e).find(e=>"button"!==e)],e)}:()=>{s.callback(e,e)};break;default:n=()=>{s.callback(e,e)}}return t(n),!1},onload:function(){const e=this.find("[autofocus]");e&&e.focus()}}}}})}),s.buttons.length){const t={buttons:{tagName:"div",css:"m2d2-alert-buttons"}};s.buttons.forEach(n=>{const s=n.toLowerCase().replace(/[^a-z ]/g,"").replace(" ","_");t.buttons[s]={tagName:"button",type:"submit",value:s,css:["color",s],text:void 0!==e.dict?e.dict(n):n,autofocus:["ok","yes"].includes(n),formNoValidate:["cancel"].includes(n),onclick:function(){e(this.closest("form"),{hide:{tagName:"input",type:"hidden",name:"button",value:this.value}})}}}),e("#m2d2-alert .m2d2-alert-front",t)}let o=1;return e("#m2d2-alert .m2d2-alert-front").findAll("input, select, textarea").forEach(e=>{""===e.name&&(e.name="field_"+o++)}),{close:t}},e.wait=(t,n,s)=>e.message({icon:"wait",title:t,buttons:[],text:void 0===s?null:n,callback:void 0===s?n:s}),e.alert=(t,n,s)=>e.message({icon:"info",title:t,buttons:["ok"],text:void 0===s?null:n,callback:void 0===s?n:s}),e.success=(t,n,s)=>e.message({icon:"ok",title:t,buttons:["ok"],text:void 0===s?null:n,callback:void 0===s?n:s}),e.failure=(t,n,s)=>e.message({icon:"error",title:t,buttons:["ok"],text:void 0===s?null:n,callback:void 0===s?n:s}),e.confirm=(t,n,s)=>e.message({icon:"question",title:t,buttons:["yes","no"],text:void 0===s?null:n,callback:void 0===s?n:s}),e.prompt=(t,n,s)=>e.message({icon:"input",title:t,buttons:["cancel","send"],text:void 0===s?null:n,callback:void 0===s?n:s}),e.closeAll=()=>{t()}}),t.load(e=>{let t=localStorage.getItem("m2d2.lang")||navigator.language;e.dict=new function(t){const n=function(e,t){if(void 0===e)return"";let s=n.val(e,!0);if(void 0!==t){if("string"==typeof t&&""!==t){const e=(t=t.replace(/;$/,"")).split(";");t={},e.forEach(n=>{const s=e[n].split(":");t[s[0]]=s[1]})}"object"==typeof t&&t.forEach(e=>{let o=t[e]+"";o=n.val(o,!1),s=s.replace(e,o)})}return s};return n.lang=t||"en",n.data={},n.set=function(e){return this.data=e,this},n.has=function(e,t){return void 0===t?void 0!==this.data[e]:void 0!==this.data[e][t]},n.val=function(t,s){if(e.isEmpty(n.data))return console.error("Dictionary is empty. You need to add a dictionary, for example: `$.dict.set({\nsave   : { en : 'Save', es : 'Guardar' },\ncancel : { en : 'Cancel', es : 'Cancelar' }\nyes    : { en : 'Yes', es : 'Si' },\nno     : { en : 'No', es : 'No' }\n})`"),"";if(!t)return console.error("No keyword specified."),"";let o=t;if(void 0===s&&(s=!1),t=t.toLowerCase(),this.has(t)){const e=this.lang.split("-")[0];this.has(t,this.lang)?o=this.data[t][this.lang]:this.has(t,e)?o=this.data[t][e]:s&&console.log("Missing translation for lang ["+this.lang+"]: "+t)}else s&&console.log("Missing keyword: "+t);return o},n}(t);const n=[];e.lang=function(t){t&&(e.dict.lang=t,localStorage.setItem("m2d2.lang",e.dict.lang)),e("body").findAll("[lang]").forEach(t=>{let n=t.text;if(n&&!t.classList.contains("notxt")){void 0===t.dataset.kw&&(t.dataset.kw=e.lang.getKeyword(n)),t.text=e.dict(t.dataset.kw);const s=t.dataset.kw+"_title";let o=e.dict.has(s)?e.dict(s):"";o&&(t.title=o)}else if(t.title){let n="";t.dataset.kw||(t.dataset.kw=e.lang.getKeyword(t.title)),n=e.dict(t.dataset.kw),n&&(t.title=n)}else if(t.placeholder){let n="";t.dataset.kw||(t.dataset.kw=e.lang.getKeyword(t.placeholder)),n=e.dict(t.dataset.kw),n&&(t.placeholder=n)}else if(t.value){let n="";t.dataset.kw||(t.dataset.kw=e.lang.getKeyword(t.value)),n=e.dict(t.dataset.kw),n&&(t.value=n)}}),n.forEach(e=>{e(t)})},e.lang.getKeyword=function(e){return e.toLowerCase().trim().replace(/ /g,"_").replace(/[^\w]/g,"").replace(/_$/,"")},Object.defineProperty(e.lang,"onchange",{get(){return this},set(t){e.isFunction(t)?n.push(t):(console.log("Unable to set lang.onchange, because it is not a function: "),console.log(t))}})}),t.ready(e=>{const t=localStorage.getItem("m2d2.lang")||"",n=e("body").find("[lang]"),s=e("html").lang||(n?n.lang:null)||"en";(t?s!==t:s!==navigator.language.split("-")[0])&&e.lang()}),t.load(e=>{function t(e){switch(e){case"local":window.localStorage&&(this.store=localStorage);break;case"session":window.sessionStorage&&(this.store=sessionStorage)}null==this.store&&(this.store=localStorage),this.set=function(e,t){"string"==typeof t&&(t={$:t}),this.store.setItem(e,JSON.stringify(t))},this.get=function(e){let t;try{t=JSON.parse(this.store.getItem(e))||{}}catch(n){t=this.store.getItem(e)}return void 0!==t.$?t=t.$:0===Object.keys(t).length&&t.constructor===Object&&(t=null),t},this.del=function(e){this.store.removeItem(e)},this.keys=function(){return Object.keys(this.store).sort()},this.clear=function(){this.store.clear()},this.exists=function(e){return this.store.hasOwnProperty(e)},this.log=function(e,t,n){null==n&&(n=10);const s=this.get(e)||[];for(s.push(t);s.length>n;)s.shift();this.set(e,s)}}e.local=new t("local"),e.session=new t("session")}),t.load(e=>{function t(e,t,n){const s=[];return e=e||{},t.forEach(o=>{const i="Array"==typeof e?e.length==t.length?e[n]:e:void 0!==e[o.name]?e[o.name]:e;s.push({file:o,data:i,index:n++})}),s}function n(e,t,n,s,o){const i=new XMLHttpRequest;t=Array.from(t),i.upload.addEventListener("progress",(function(e){if(e.lengthComputable)if(s.oneByOne){const o=Math.round(100*e.loaded/e.total);s.onUpdate(o,t[0],n)}else{let n=0,o=0;t.some(t=>{n+=t.size;const i=e.loaded>=n?100:100-Math.round(100*(n-e.loaded)/t.size);return s.onUpdate(i,t,o++),n>=e.loaded})}}),!1),i.addEventListener("load",(function(e){let l={};try{l=i.responseText?JSON.parse(i.responseText):{error:{type:"Unknown",reason:"Unknown Error"}}}catch(e){l.error={type:"Parse Error",reason:e.message}}i.status>=200&&i.status<400?o(s.onResponse(l),t,n):("string"==typeof l.error&&(l.error={type:"Exception",reason:l.error}),s.onError(l.error))}),!1),i.open("POST",s.upload);const l=Array(t.length).fill(!1),a=function(e,t){const n=new FormData;return t.forEach(t=>{n.append(e,t,t.name)}),n}(e,t);let r=0;t.forEach(e=>{const t=new FileReader;t.onload=function(e){l[r++]=!0,-1===l.indexOf(!1)&&i.send(a)},t.readAsBinaryString(e)})}e.upload=function(e,s){const o=Object.assign({},{accept:"*/*",parallel:!1,field:"file",multiple:!0,maxFiles:0,maxSizeMb:0},s);s=null;let i=window._protected_reference=document.createElement("INPUT");i.name=o.field,i.type="file",1==o.multiple&&(i.multiple="multiple"),o.upload||(console.log("Upload not specified. Using current page."),o.upload=""),null==o.onDone&&(o.onDone=(e,t)=>{console.log(e)}),null==o.onError&&(o.onError=e=>{console.log("Error : "),console.log(e)}),null==o.onUpdate&&(o.onUpdate=(e,t,n)=>{console.log("Uploading : "+e+"% "+(o.oneByOne?"[ "+t.name+" ]":""))}),null==o.onResponse&&(o.onResponse=e=>e),i.addEventListener("change",()=>{if(i.files.length){if(!(0===o.maxFiles|i.files.length<=o.maxFiles))return o.onError("Max file limit exceeded. Maximum files: "+o.maxFiles),!1;if(o.onSelect){const e=[];let t=0;Array.from(i.files).forEach(n=>{e.push(URL.createObjectURL(n)),t+=n.size});const n=t/1048576;if(o.maxSizeMb&&n>o.maxSizeMb)return o.onError("Maximum size exceeded: "+Math.ceil(n)+"MB > "+o.maxSizeMb+"MB"),!1;o.onSelect(i.files,e)}new Promise(e=>{if(o.oneByOne){let s=0;const l=Array(i.files.length).fill(!1);Array.from(i.files).forEach(a=>{new n(i.name,[a],s++,o,(n,s,i)=>{l[i]=!0;const a=-1===l.indexOf(!1);o.onDone(t(n,s,i),a),a&&e()})})}else new n(i.name,i.files,0,o,(n,s,i)=>{o.onDone(t(n,s,i),!0),e()})}).then(()=>{i=window._protected_reference=void 0})}}),i.click()}}),t.load(e=>{const t=function(e,t,n,s,o,i){const l=new XMLHttpRequest;if(void 0===i&&(i=!1),void 0===o&&(o=function(e){console.log(e)}),n&&0===Object.entries(n).length&&(n=""),n)if(i)n=JSON.stringify(n);else switch(e.toUpperCase()){case"GET":t+=(-1!==t.indexOf("?")?"&":"?")+Object.keys(n).map(e=>e+"="+n[e]).join("&"),n="";break;default:n=Object.keys(n).map(e=>e+"="+n[e]).join("&")}return l.open(e,t,!0),i?l.setRequestHeader("Content-Type","application/json"):l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onerror=function(e){o({type:"Connection",reason:"Connection Refused"})},l.onload=function(){let e={};try{e=l.responseText?JSON.parse(l.responseText):{error:{type:"Unknown",reason:"Unknown Error"}}}catch(t){e.error={type:"Parse Error",reason:t.message}}l.status>=200&&l.status<400?void 0!==s&&s(e):void 0!==o&&("string"==typeof e.error&&(e.error={type:"Exception",reason:e.error}),o(e.error))},l.send(n),l},n={};["get","post","put","delete","connect","options","trace","patch"].forEach((function(e){n[e]=function(){let n,s,o,i,l;switch(arguments.length){case 5:"boolean"==typeof arguments[4]?l=arguments[4]:console.log("Passed JSON argument: "+arguments[4]+" is not boolean.");case 4:"function"==typeof arguments[3]?i=arguments[3]:4===arguments.length&&"boolean"==typeof arguments[3]?l=arguments[3]:console.log("Passed argument 4: "+arguments[3]+" is mistaken");case 3:"function"==typeof arguments[2]?"function"==typeof arguments[1]&&arguments.length<5?i=arguments[2]:o=arguments[2]:3===arguments.length&&"boolean"==typeof arguments[2]?l=arguments[2]:console.log("Passed argument 3: "+arguments[2]+" is mistaken");case 2:"object"==typeof arguments[1]||"string"==typeof arguments[1]?s=arguments[1]:"function"==typeof arguments[1]?o=arguments[1]:console.log("Passed argument 2: "+arguments[1]+" is mistaken");case 1:"string"==typeof arguments[0]?n=arguments[0]:Array.isArray(arguments[0])?n=arguments[0].join("/"):console.log("Passed URL: "+arguments[0]+" was not a string.");break;default:console.log("Incorrect number of arguments passed to xhr")}return void 0===s&&(s={}),t(e.toUpperCase(),n,s,o,i,l)}})),Object.assign(e,n)}),t}));