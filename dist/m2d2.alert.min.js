/**
 * Author : A.Lepe (dev@alepe.com) - intellisrc.com
 * License: MIT
 * Version: 2.1.1
 * Updated: 2022-02-24
 * Content: Extension
 */

m2d2.load(t=>{function e(e){if(t.exists("#m2d2-alert .m2d2-alert-front")){t("#m2d2-alert .m2d2-alert-front").css.add("vanish"),setTimeout(()=>{t.exists("#m2d2-alert .m2d2-alert-front")&&t("#m2d2-alert").remove(),e&&e()},400)}else e&&e()}const a={wrap:!1,question:["fa","fa-question-circle"],info:["fa","fa-exclamation-circle"],error:["fa","fa-exclamation-triangle"],ok:["fa","fa-check"],input:["fa","fa-edit"],wait:["fa","fa-cog","fa-spin"]},n={wrap:"material-icons",question:"help",info:"info",error:"error",ok:"done",input:"edit",wait:"pending"},c={wrap:!1,question:"icon_question",info:"icon_info",error:"icon_error",ok:"icon_ok",input:"icon_input",wait:"icon_wait"};t.message=function(o){let i=c;switch(t.messageIcons){case"fa":i=a;break;case"material":i=n}o&&(t.isFunction(o.callback)||(o.callback&&!o.text&&(o.text=o.callback),o.callback=()=>{}),o.text||(o.text="")),e(()=>{t("body",{m2d2Alert:{tagName:"div",id:"m2d2-alert",back:{tagName:"div",css:"m2d2-alert-back",style:{position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:"#0005",display:"flex",justifyContent:"center",alignItems:"center"},front:Object.assign({tagName:"form",css:(o.css?t.isArray(o.css)?o.css:[o.css]:[]).concat(["m2d2-alert-front","popup",o.icon]),style:{zIndex:100},icon:{tagName:"span",css:["icon",o.icon,i.wrap||i[o.icon]].concat("wait"===o.icon?"spin":""),text:i.wrap?i[o.icon]:""},message:{tagName:"div",css:"m2d2-alert-title",span:o.title},submsg:(()=>{let e;return e="input"!==o.icon||o.text?t.isPlainObject(o.text)?{fieldset:Object.assign({css:"m2d2-alert-field"},o.text)}:{span:o.text.replace("\n","<br>")}:{fieldset:{css:"m2d2-alert-field",input:{type:"text",name:"answer",onload:function(){this.focus()}}}},Object.assign({tagName:"div",css:"m2d2-alert-text"},e)})(o.icon),onsubmit:function(){const t=this.getData();let a;switch(t.button){case"ok":case"yes":a=()=>{o.callback(!0,t)};break;case"no":a=()=>{o.callback(!1,t)};break;case"cancel":a=()=>{o.callback(null,t)};break;case"send":a=1===Object.keys(t).length?()=>{o.callback(t[Object.keys(t)[0]],t)}:2===Object.keys(t).length?()=>{o.callback(t[Object.keys(t).find(t=>"button"!==t)],t)}:()=>{o.callback(t,t)};break;default:a=()=>{o.callback(t,t)}}return e(a),!1},onload:function(){const t=this.find("[autofocus]");t&&t.focus()}},function(e){let a={};return e.length&&(a={buttons:{tagName:"div",css:"m2d2-alert-buttons"}},e.forEach(e=>{const n=e.toLowerCase().replace(/[^a-z ]/g,"").replace(" ","_");a.buttons[n]={tagName:"button",type:"submit",value:n,css:["color",n],text:void 0!==t.dict?t.dict(e):e,autofocus:["ok","yes"].includes(e),formNoValidate:["cancel"].includes(e),onclick:function(){t(this.closest("form"),{hide:{tagName:"input",type:"hidden",name:"button",value:this.value}})}}})),a}(o.buttons))}}})});let s=1;return t("#m2d2-alert .m2d2-alert-front").findAll("input, select, textarea").forEach(t=>{""===t.name&&(t.name="field_"+s++)}),{close:e}},t.wait=(e,a,n)=>t.message({icon:"wait",title:e,buttons:[],text:void 0===n?null:a,callback:void 0===n?a:n}),t.alert=(e,a,n)=>t.message({icon:"info",title:e,buttons:["ok"],text:void 0===n?null:a,callback:void 0===n?a:n}),t.success=(e,a,n)=>t.message({icon:"ok",title:e,buttons:["ok"],text:void 0===n?null:a,callback:void 0===n?a:n}),t.failure=(e,a,n)=>t.message({icon:"error",title:e,buttons:["ok"],text:void 0===n?null:a,callback:void 0===n?a:n}),t.confirm=(e,a,n)=>t.message({icon:"question",title:e,buttons:["yes","no"],text:void 0===n?null:a,callback:void 0===n?a:n}),t.prompt=(e,a,n)=>t.message({icon:"input",title:e,buttons:["cancel","send"],text:void 0===n?null:a,callback:void 0===n?a:n}),t.closeAll=()=>{e()}});