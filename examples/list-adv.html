<html lang="en">
<head>
<title>Demo using M2D2 : Lists - Advaced example</title>
<meta charset="UTF-8">
<meta name="HandheldFriendly" content="1">
<meta name="viewport" content="width=device-width, maximum-scale=1.0">
<meta name="theme-color" content="#333333">
<link rel="stylesheet" href="../css/examples.css" type="text/css" />
<!-- Import Demo menu: -->
<script src="../js/demo-links.js" type="text/javascript"></script>
<!--                   -->
<style type="text/css">
    #items .price {
        text-align: right;
        padding-right: 5px;
    }
    #items .price:before {
        content : '$ ';
    }
    #items .id, #items .delete {
        text-align: center !important;
    }
    #items .delete, #items .name, #items .price {
        border-right: 1px solid #CCC;
        cursor: pointer;
    }
</style>
<script src="../dist/m2d2.min.js" type="text/javascript"></script>
<script type="text/javascript">
//On ready...
let list, actions, loading; //For debugging purposes
document.addEventListener("DOMContentLoaded", function() {
    // This example is to show how to generate lists using a function
    list = m2d2("#items", {
        template : {
            tr : {
                id : {
                    tagName : "td",
                    css : "id",
                    width: "5%",
                    text : ""
                },
                name : {
                    tagName : "td",
                    css : "name",
                    title: "Change Item",
                    width: "84%",
                    onclick : function (event) {
                        const td = event.target;
                        const id = td.parentNode.dataset.id;
                        let newName = prompt("Please enter new item name: ", td.textContent);
                        if(newName) {
                            list.items[id].name = newName;
                        }
                    }
                },
                price : {
                    tagName : "td",
                    css : "price",
                    title : "Change price",
                    width : "10%",
                    onclick : function (event) {
                        const td = event.target;
                        const id = td.parentNode.dataset.id;
                        let newPrice = prompt("Please enter new price: ", td.textContent);
                        if(newPrice) {
                            list.items[id].price = newPrice;
                        }
                    }
                },
                delete : {
                    tagName : "td",
                    css : "delete",
                    title : "Delete Item",
                    text : "âœ–",
                    width : "1%",
                    onclick : function(event) {
                        const td = event.target;
                        const id = td.parentNode.dataset.id;
                        list.items.splice(id, 1);
                    }
                }
            }
        },
        items : []
    });
    (async() => {
        // Simulating loading data from remote server:
        // let response = await fetch("/some.service"); // Something like that
        // let data = await response.json();
        await Utils.sleep(1000);
        // Using 'color' from 'style' plugin (m2d2.style.src.js)
        const data = [
            {
                id    : 1,
                price : 100,
                name  : "Doggy Bag",
                color : "#713c3c"
            },{
                id    : 2,
                price : 200,
                name  : "Skateboard",
                color : "#3c7141"
            },{
                id    : 3,
                price : 500,
                name  : "Sassy Pants",
                color : "#3c3f71"
            }
        ];
        // "actions" object can be used here because by this time it has been already initialized.
        actions.add.disabled = false;
        loading.show = false;
        list.items = data; // We could push each item in data, but this way renders faster
    })()

    // Build Headers
    const headers = m2d2("#heads", {
        tr : {
            template : "th",
            items : ["ID","Item","Price","Del"]
        }
	});
    
    let count = 0;
    // Action buttons:
    actions = m2d2("#actions", {
		add : {
			disabled : true,
			onclick : function(event) {
                const colors = [];
                for(let c=0; c<3; c++) {
                    colors.push(Math.round(Math.random() * 255));
                }
				list.items.push({
				  id    : list.items.length + 1,
				  price : Math.round((Math.random() * 100000 / 100)),
				  name  : "Extra Item " + (++count),
				  color : "rgb("+colors[0]+","+colors[1]+","+colors[2]+")"
				});
			}
		}
    });
	loading = m2d2("#loading", {
		show : true
	});
});
</script>
</head>
<body>
<article>
    <h1>M2D2 List example</h1>
    <p>This example loads the list using an async function. Then allows you to add or remove items as you want.</p>
    <table id="checkout">
      <caption>My whish list:</caption>
      <thead id="heads"></thead>
      <tbody id="items"></tbody>
    </table>
    <div id="loading">Loading... (Simulating slow connection)</div>
    <div id="actions" class="controls">
        <div>
            <button class="add">Add Row</button>
        </div>
    </div>
</article>
</body>
</html>
