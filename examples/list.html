<html>
<head>
<title>Demo using M2D2 : Lists</title>
<meta name="HandheldFriendly" content="1">
<meta name="viewport" content="width=device-width, maximum-scale=1.0">
<meta name="theme-color" content="#333333">
<link rel="stylesheet" href="../css/examples.css" type="text/css" />
<script src="../js/utils.src.js" type="text/javascript"></script>
<script src="../js/m2d2.src.js" type="text/javascript"></script>
<!-- Import Demo menu: -->
<!--script src="../js/demo-links.js" type="text/javascript"></script-->
<!--                   -->
<script type="text/javascript">

//Placed here so they are available on console
let checkout;
let actions;
let olist;

//On ready...
document.ready(m2d2 => {

    function selectItem(ev) {
        this.selected = true;
        actions.$remove.disabled = false;
        actions.box.price.disabled = false;
        actions.box.price.value = "";
        actions.box.price.focus();
    }

    function onUpdate(ev) {
        console.log(ev.detail);
    }

    // This example is to show how to generate lists
    checkout = m2d2("#checkout", {
        list : {
            items : [
            {
                id : "it1",
                item_id: "DB001",
                price: 100,
                name: "Doggy Bag",
                style : { color: "#713c3c" },
                onclick : selectItem
            }, {
                id : "it2",
                item_id: "SB002",
                price: 200,
                name: "Skateboard",
                style : { color: "#3c7141" },
                onclick : selectItem
            }, {
                id : "it3",
                item_id: "DH003",
                price: 150,
                name: "Doll House",
                style : { color: "#3c7141" },
                onclick : selectItem
            }, {
                id : "it4",
                item_id: "BG004",
                price: 125,
                name: "Board Game",
                style : { color: "#3c4133" },
                onclick : selectItem
            }, {
                id : "it5",
                item_id: "SP005",
                price: 500,
                name: "Sassy Pants",
                style : { color: "#AA3f71" },
                onclick : selectItem
            }, {
                id : "it6",
                item_id: "SB006",
                price: 350,
                name: "Soccer Ball",
                style : { color: "#3cAA71" },
                onclick : selectItem
            }, {
                id : "it7",
                item_id: "RR007",
                price: 425,
                name: "Red Rocket",
                style : { color: "#3c3fAA" },
                onclick : selectItem
            }, {
                id : "it8",
                item_id: "BG008",
                price: 50,
                name: "Bubble Gum",
                style : { color: "#3c0071" },
                onclick : selectItem
            }, {
                id : "it9",
                item_id: "GC009",
                price: 550,
                name: "Game Console",
                style : { color: "#3c3f00" },
                onclick : selectItem
            }
        ]},
        total : 0
    });

    // When not using explicitly "items" in definition, you can call the update this way:
    checkout.list.onupdate = function(ev) {
        checkout.total = checkout.list.items.length;
    }

    actions = m2d2("#actions", {
        // To Sort by Price:
        sort : {
            onupdate : onUpdate,
            onclick : function (ev) {
                if(this.classList.contains("sorted")) {
                    checkout.list.items.reverse();
                } else {
                    checkout.list.items.sort((a, b) => { return a.price.text * 1 - b.price.text * 1 });
                }
                this.classList.toggle("sorted");
            }
        },
        prepend : {
            onupdate : onUpdate,
            onclick: function (ev) {
                const i = checkout.total.text * 1;
                checkout.list.items.unshift({
                    id: "it" + (i + 1),
                    item_id: "EI" + (i + "").padStart(3, "0"),
                    price: Math.round((Math.random() * 100000 / 100)),
                    name: "Extra Item",
                    style: { color: "#B17E28" },
                    onupdate : onUpdate,
                    onclick : selectItem
                });
            }
        },
        append : {
            onupdate : onUpdate,
            onclick: function (ev) {
                const i = checkout.total.text * 1;
                checkout.list.items.push({
                    id: "it" + (i + 1),
                    item_id: "EI" + (i + "").padStart(3, "0"),
                    price: Math.round((Math.random() * 100000 / 100)),
                    name: "Extra Item",
                    style: { color: "#B17E28" },
                    onupdate : onUpdate,
                    onclick : selectItem
                });
            }
        },
        remove: {
            disabled : true,
            onupdate : onUpdate,
            onclick: function (ev) {
                const sel = checkout.list.find("[selected]");
                if(sel) {
                    sel.remove();
                }
            },
            onload : function(ev) {
                //console.log(ev);
                // console.log(this);
                console.log("Remove was loaded");
            }
        },
        box: {
            price: {
                disabled : true,
                className : "default",
                onupdate : onUpdate,
                onkeyup: function (ev) {
                    const sel = checkout.list.find("[selected]");
                    if(sel) {
                        sel.price.text = this.value * 1;
                    }
                },
                onload : function(ev) {
                    //console.log(ev);
                    // console.log(this);
                    console.log("Price was loaded");
                }
            }
        }
    });

    olist = m2d2("ol", {
        li : {
            style : { color : "green" }
        }
    });

    // Multiple calls to "onupdate" are allowed:
    actions.box.price.onupdate = function(ev) {
        if(ev.detail.type !== "function") {
            console.log("Updated: " + ev.detail.oldValue + " -> " + ev.detail.newValue);
        }
    }

    // NOTE: as remove() function exists in node "div#actions",
    // this element will be linked as: '$remove' (see console logs).
    // In other words, to access "remove" button use (e.g.):
    // actions.$remove.disabled = true;

});
</script>
</head>
<body>
<article>
    <h1>M2D2 List example</h1>
    <table id="checkout">
      <caption>My wish list:</caption>
      <tbody id="list">
        <template>
            <tr>
              <td class="item_id"></td>
              <td><a class="name"></a></td>
              <td>$ <span class="price"></span></td>
            </tr>
        </template>
      </tbody>
      <tfoot>
        <tr><td>Total:</td><td colspan="2" class="total"></td></tr>
      </tfoot>
    </table>
    <div id="actions" class="controls">
        <div>
            <button class="prepend">Prepend Item</button>
            <button class="append">Append Item</button>
            <button class="sort">Sort By Price</button>
            <button class="remove">Remove Item</button>
        </div>
        <div class="box">Change Price of selected item: <input class="price" type="number" /></div>
    </div>
    <p>
        There are many ways in which you can access the items in the list (the most common are):
        <ol>
            <li><b>By index:</b>  <code>checkout.list.items[index];</code></li>
            <li><b>By data-id:</b>  <code>checkout.list.items.getId(id);</code></li>
            <li><b>By element id:</b>  <code>checkout.list.items.it4;</code></li>
            <li><b>By searching in parent:</b>  <code>checkout.list.find("#it4");</code></li>
        </ol>
    </p>
</article>
</body>
</html>
