<html>
<head>
<title>Demo using M2D2 : Lists - Advaced example</title>
<meta name="HandheldFriendly" content="1">
<meta name="viewport" content="width=device-width, maximum-scale=1.0">
<meta name="theme-color" content="#333333">
<link rel="stylesheet" href="css/common.css" type="text/css" />
<link rel="stylesheet" href="css/index.css" type="text/css" />
<script src="js/m2d2.src.js" type="text/javascript"></script>
<script src="js/m2d2.style.src.js" type="text/javascript"></script>
<script type="text/javascript">
//On ready...
var list;
document.addEventListener("DOMContentLoaded", function() {
    // This example is to show how to generate lists using a function
    list = m2d2("#items", function(callback) {
		// Simulating loading data from remote server:
		setTimeout(function() {
			// "actions" object can be used here as by this time it already exists. 
			actions.price.disabled = false;
			actions.add.disabled = false;
			actions.del.disabled = false;
			// Using 'color' from 'style' plugin (m2d2.style.src.js)
			callback([
				{
					  id : 1,
					  price: 100,
					  name : "Doggy Bag",
					  color: "#713c3c"
				},{
					  id : 2,
					  price: 200,
					  name : "Skateboard",
					  color: "#3c7141"
				},{
					  id    : 5,
					  price : 500,
					  name  : "Sassy Pants",
					  color : "#3c3f71"
				}
			],{ // Template specified as second argument (instead of HTML):
				// Using 'css' from 'style' plugin:
				tr : {
					template : {
						td : {	//TODO: onclick is getting lost somewhere
							onclick : function(event) {
								alert("You clicked:" + event.target.text);
							},
							style : "font-weight: bold"
						} 
					},
					data : [
						{ css : "id" },
						{ css : "name" },
						{ 
							text : '$ ', 
							span : {
								css : "price"
							}
						}
					]
				}
			});
		}, 2000);

		//TODO: first issue: without "return" we can't update the list (data is in: list.m2d2._data) , and can be modified with splice.
		// Returing initial layout:
		// As we are also defining events and other properties besides data,
		// We need to specify the data as empty array so it can be correctly assigned.
		/*return {	//TODO: when enabling "return" data is not displayed after 2 secs. However, when we click "add", it will show it. Splice doesn't work in this case.
			data : [], // Must include in this case
			title : "Click me"
		}*/
	});

	// Note how we are using list.data instead of just "list"
    var actions = m2d2("#actions", {
		price : {
			disabled : true,
			onkeyup : function(event) {
				list.data[1].price = this.value * 1;
			}
		},
		add : {
			disabled : true,
			onclick : function(event) {
				list.data.push({
				  id    : Math.round((Math.random() * 1000 / 100)),
				  price : Math.round((Math.random() * 100000 / 100)),
				  name  : "Extra Item",
				  color : "#B17E28"
				});
			}
		},
		del : { 
			disabled : true,
			onclick : function(event) {
				list.data.splice(0, 1);
			}
		}
    });
});
</script>
</head>
<body>
<h1>M2D2 List example</h1>
<table id="checkout">
  <caption>My whish list:</caption>
  <tbody id="items"><tr><td class="loading">Loading...</td></tr></tbody>
</table>
<div id="actions" class="controls">
    <div>
		<button class="add">Add Row</button>
		<button class="del">Remove Row</button>
	</div>
    <div>Change Price: <input class="price" type="number" /></div>
</div>
Next: <a href="async.html">Async example</a>
</body>
</html>
